<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadoras de Enfermagem</title>
    <meta name="description" content="Ferramentas e calculadoras para profissionais de enfermagem.">

    <!-- ============================================ -->
    <!-- BIBLIOTECAS EXTERNAS (CDN)                  -->
    <!-- ============================================ -->
    
    <!-- THREE.js - DEVE vir antes do preload.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <!-- ============================================ -->
    <!-- ESTILOS (CSS)                                -->
    <!-- ============================================ -->
    
    <!-- Estilos Globais -->
    <link rel="stylesheet" href="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/css/global.css">
    <link rel="stylesheet" href="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/css/main.css">

    <!-- Estilos de Componentes -->
    <link rel="stylesheet" href="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/css/preload.css">
    <link rel="stylesheet" href="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/css/accessibility.css">
    <link rel="stylesheet" href="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/css/header.css">
    <link rel="stylesheet" href="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/css/footer.css">

    <!-- Estilos Inline para comportamento do Preload -->
    <style>
        .component-placeholder {
            min-height: 50px;
        }

        /* Configuração do Preload para cobrir a tela inteira */
        #component-preload {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 99999;
            background-color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            
            /* Transição suave para desaparecer */
            opacity: 1;
            visibility: visible;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        /* Classe que será adicionada via JS para esconder o preload */
        #component-preload.fade-out {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <!-- ============================================ -->
    <!-- ESTRUTURA MODULAR (Placeholders)             -->
    <!-- ============================================ -->

    <!-- 1. Acessibilidade -->
    <div id="component-accessibility" class="component-placeholder"></div>

    <!-- 2. Header -->
    <header id="component-header" class="component-placeholder"></header>

    <!-- 3. Conteúdo Principal (Main Index) -->
    <main id="component-main-index" class="component-placeholder"></main>

    <!-- 4. Footer -->
    <footer id="component-footer" class="component-placeholder"></footer>

    <!-- 5. Preload (Cobre a tela inteira) -->
    <div id="component-preload" class="component-placeholder"></div>


    <!-- ============================================ -->
    <!-- SCRIPT DE CARREGAMENTO MODULAR               -->
    <!-- ============================================ -->
    <script>
        /**
         * Carregador Simples de Componentes
         */
        const components = [
            { 
                id: 'component-accessibility', 
                url: 'https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/components/accessibility.html' 
            },
            { 
                id: 'component-header', 
                url: 'https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/components/header.html' 
            },
            { 
                id: 'component-main-index', 
                url: 'https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/pages/main-content.html' 
            },
            { 
                id: 'component-footer', 
                url: 'https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/components/footer.html' 
            },
            { 
                id: 'component-preload', 
                url: 'https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/components/preload.html' 
            }
        ];

        async function loadComponents() {
            const fetchPromises = components.map(async (comp) => {
                const element = document.getElementById(comp.id);
                if (!element) return;

                try {
                    const response = await fetch(comp.url);
                    if (!response.ok) throw new Error(`Erro HTTP: ${response.status}`);
                    
                    const html = await response.text();
                    element.innerHTML = html;
                    element.classList.remove('component-placeholder');
                    console.log(`Componente carregado: ${comp.id}`);
                } catch (error) {
                    console.error(`Falha ao carregar ${comp.url}:`, error);
                }
            });

            await Promise.all(fetchPromises);
            document.dispatchEvent(new Event('componentsLoaded'));
        }

        document.addEventListener('DOMContentLoaded', () => {
            // 1. Inicia o carregamento dos componentes
            loadComponents();

            // 2. Lógica do Temporizador do Preload (5 Segundos)
            setTimeout(() => {
                const preloadElement = document.getElementById('component-preload');
                if (preloadElement) {
                    // Inicia a transição de fade-out
                    preloadElement.classList.add('fade-out');
                    console.log("Preload iniciando transição de saída.");
                    
                    // Aguarda a transição de 500ms terminar ANTES de disparar o evento
                    setTimeout(() => {
                        // DISPARA O EVENTO que habilita os botões flutuantes e banner de cookies
                        document.dispatchEvent(new Event('preloadFinalizado'));
                        console.log("Evento preloadFinalizado disparado.");
                    }, 550); // 550ms para garantir que a transição terminou
                }
            }, 5000);
        });
    </script>


    <!-- ============================================ -->
    <!-- SCRIPTS (JS)                                 -->
    <!-- ============================================ -->
    
    <!-- Scripts utilitários -->
    <script src="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/js/utils.js"></script>
    <script src="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/js/console-cleaner.js"></script>

    <!-- THREE.js já está carregado no head, agora carrega o preload.js -->
    <script src="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/js/preload.js"></script>
    <script src="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/js/accessibility.js"></script>
    <script src="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/js/header.js"></script>
    <script src="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/js/footer.js"></script>

    <!-- Scripts globais -->
    <script src="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/js/global-main.js"></script>
    <script src="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/js/global-main-index.js"></script>
    
    <!-- Script de carregamento da página principal -->
    <script src="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/js/main-index-loader.js"></script>
    <script src="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/js/module-loader.js"></script>

    <!-- ============================================ -->
    <!-- SCRIPT PÓS-PRELOAD                           -->
    <!-- ============================================ -->
    <!-- 
        Este script ativa os elementos que devem aparecer 
        somente após o preload: FAB de cookies, back to top, etc.
    -->
    <script>
        /**
         * Controlador de Elementos Pós-Preload
         * Ativa FAB de cookies, back to top e banner de cookies
         * após a conclusão do preload.
         */
        
        (function() {
            'use strict';

            // Elementos a serem ativados após o preload
            const ELEMENTS = {
                cookieFab: 'cookie-fab',
                backToTop: 'backToTop',
                cookieBanner: 'cookie-banner'
            };

            /**
             * Ativa um elemento removendo classes de ocultação
             */
            function activateElement(id) {
                const element = document.getElementById(id);
                if (!element) {
                    console.warn(`Elemento ${id} não encontrado`);
                    return false;
                }

                // Remove classes de ocultação
                element.classList.remove('hidden');
                element.classList.add('visible');
                
                console.log(`Elemento ${id} ativado`);
                return true;
            }

            /**
             * Tenta ativar os elementos pós-preload
             */
            function activatePostPreloadElements() {
                // Ativa FAB de cookies
                activateElement(ELEMENTS.cookieFab);
                
                // Ativa back to top (funcionalidade de scroll será gerenciada pelo footer.js)
                activateElement(ELEMENTS.backToTop);
                
                // Dispara evento para banner de cookies (se ainda não tiver escolha)
                const hasCookieChoice = localStorage.getItem('ce_cookie_consent_v8_2025');
                if (!hasCookieChoice) {
                    // Pequeno delay para garantir que o banner está pronto
                    setTimeout(() => {
                        const banner = document.getElementById(ELEMENTS.cookieBanner);
                        if (banner) {
                            banner.classList.remove('hidden');
                            banner.classList.add('visible');
                            console.log('Banner de cookies ativado');
                        }
                    }, 300);
                }
            }

            // Escuta o evento preloadFinalizado
            document.addEventListener('preloadFinalizado', () => {
                console.log('Evento preloadFinalizado recebido - ativando elementos');
                
                // Tenta ativar imediatamente
                activatePostPreloadElements();

                // Tenta novamente após delay (fallback)
                setTimeout(activatePostPreloadElements, 500);
            });

            // Fallback: se o preload já terminou antes deste script carregar
            setTimeout(() => {
                const preload = document.getElementById('component-preload');
                if (preload && preload.classList.contains('fade-out')) {
                    console.log('Preload já terminou - ativando elementos (fallback)');
                    activatePostPreloadElements();
                }
            }, 1000);

            console.log('Controlador de elementos pós-preload inicializado');
        })();
    </script>

</body>
</html>
