<!DOCTYPE html>
<html lang="pt-br" class="scroll-smooth">
<head>
    <!-- 1. Configurações Iniciais e Performance -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="theme-color" content="#1A3E74">

    <!-- Preconnect para recursos externos -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- 2. SEO e Metadados -->
    <title>Calculadoras de Enfermagem — Escalas Clínicas e Ferramentas</title>
    <meta name="description" content="Mais de 50 calculadoras e escalas clínicas para profissionais de enfermagem.">
    
    <!-- Favicon -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">

    <!-- 3. CSS - Carregamento Modularizado -->
    <!-- Frameworks e Bibliotecas -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: { extend: { colors: { primary: '#1A3E74', accent: '#1e40af' } } }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <!-- Estilos Globais e Críticos -->
    <link rel="stylesheet" href="assets/css/preload.css">
    <link rel="stylesheet" href="assets/css/global.css">
    <link rel="stylesheet" href="assets/css/global-main.css">
    <link rel="stylesheet" href="assets/css/whitespace-fix.css">

    <!-- Estilos de Componentes -->
    <link rel="stylesheet" href="assets/css/header.css">
    <link rel="stylesheet" href="assets/css/mega-menu-final.css">
    <link rel="stylesheet" href="assets/css/accessibility.css">
    <link rel="stylesheet" href="assets/css/footer.css">
    
    <!-- Estilos da Página Principal -->
    <link rel="stylesheet" href="assets/css/global-main-index.css">

</head>
<body class="bg-gray-50 text-gray-800 relative">

    <!-- 4. Placeholders dos Componentes (Skeleton) -->
    
    <!-- Preloader (Carregado primeiro) -->
    <div id="preload-container"></div>

    <!-- Widgets de Acessibilidade (VLibras e Botões) -->
    <div id="accessibility-container"></div>
    <div vw class="enabled" style="display:none"> <!-- Placeholder para VLibras se necessário injetar dps -->
        <div vw-access-button class="active"></div>
        <div vw-plugin-wrapper><div class="vw-plugin-top-wrapper"></div></div>
    </div>

    <!-- Cabeçalho -->
    <header id="header-container" class="relative z-50"></header>

    <!-- Conteúdo Principal -->
    <main id="main-container" class="min-h-screen pt-4 md:pt-6 pb-12">
        <!-- O conteúdo de assets/pages/main-index.html será injetado aqui -->
        <div class="flex justify-center items-center h-64">
            <span class="animate-pulse text-primary">Carregando conteúdo...</span>
        </div>
    </main>

    <!-- Rodapé -->
    <footer id="footer-container" class="relative z-40"></footer>

    <!-- 5. Scripts de Orquestração -->
    
    <!-- Configuração do App -->
    <script>
        // CONFIGURAÇÃO CENTRAL
        // Mude para "" se estiver rodando localmente com a estrutura de pastas correta.
        // Mude para a URL do GitHub se quiser forçar o carregamento remoto (pode dar erro de CORS localmente).
        const APP_CONFIG = {
            baseUrl: "", // Ex: "https://auditeduca.github.io/Calculadoras-de-Enfermagem/"
            components: [
                { id: 'preload-container', url: 'assets/components/preload.html' },
                { id: 'accessibility-container', url: 'assets/components/accessibility.html' },
                { id: 'header-container', url: 'assets/components/header.html' },
                { id: 'footer-container', url: 'assets/components/footer.html' },
                { id: 'main-container', url: 'assets/pages/main-index.html' }
            ],
            scripts: [
                // Utilitários essenciais
                'assets/js/utils.js',
                'assets/js/console-cleaner.js',
                
                // Scripts de Componentes (ordem lógica)
                'assets/js/preload.js',
                'assets/js/accessibility.js', 
                'assets/js/header.js',
                
                // Scripts da Página Principal
                'assets/js/global-main.js',
                'assets/js/global-main-index.js',
                
                // Finalização
                'assets/js/footer.js'
            ]
        };
    </script>

    <!-- Loader Modular -->
    <script>
        class AppLoader {
            constructor(config) {
                this.config = config;
                this.init();
            }

            async init() {
                console.log('[AppLoader] Iniciando orquestração...');
                const start = performance.now();

                try {
                    // 1. Carregar HTML dos Componentes em Paralelo
                    await this.loadAllComponents();

                    // 2. Inicializar VLibras (se necessário)
                    this.initVLibras();

                    // 3. Carregar Scripts JS em Sequência (para respeitar dependências)
                    await this.loadAllScripts();

                    const end = performance.now();
                    console.log(`[AppLoader] Carregamento completo em ${Math.round(end - start)}ms`);
                    
                    // Dispara evento global para avisar que tudo está pronto
                    window.dispatchEvent(new CustomEvent('AppReady'));

                } catch (error) {
                    console.error('[AppLoader] Erro crítico:', error);
                }
            }

            // Busca e injeta o HTML
            async fetchComponent(component) {
                const element = document.getElementById(component.id);
                if (!element) return;

                try {
                    const fullUrl = this.config.baseUrl + component.url;
                    const response = await fetch(fullUrl);
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    
                    const html = await response.text();
                    element.innerHTML = html;
                    // Remove atributos de placeholder/loading se houver
                    element.removeAttribute('aria-busy');
                } catch (err) {
                    console.error(`[AppLoader] Falha ao carregar ${component.id}:`, err);
                    element.innerHTML = `<div class="p-4 text-red-600">Erro ao carregar componente.</div>`;
                }
            }

            async loadAllComponents() {
                const promises = this.config.components.map(c => this.fetchComponent(c));
                return Promise.all(promises);
            }

            // Carrega scripts dinamicamente
            loadScript(src) {
                return new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    script.src = this.config.baseUrl + src;
                    script.async = false; // Garante execução na ordem
                    script.onload = () => resolve(src);
                    script.onerror = () => {
                        console.warn(`[AppLoader] Falha script: ${src}`);
                        resolve(src); // Resolve mesmo com erro para não travar a fila
                    };
                    document.body.appendChild(script);
                });
            }

            async loadAllScripts() {
                for (const src of this.config.scripts) {
                    await this.loadScript(src);
                }
            }

            initVLibras() {
                // Injeta script do VLibras apenas se não existir
                if (!document.querySelector('script[src*="vlibras-plugin.js"]')) {
                    const script = document.createElement('script');
                    script.src = "https://vlibras.gov.br/app/vlibras-plugin.js";
                    script.onload = () => {
                        if (window.VLibras) new window.VLibras.Widget('https://vlibras.gov.br/app');
                    };
                    document.body.appendChild(script);
                }
            }
        }

        // Iniciar quando o DOM estiver pronto
        document.addEventListener('DOMContentLoaded', () => new AppLoader(APP_CONFIG));
    </script>
</body>
</html>