<!DOCTYPE html>
<html lang="pt-br" class="scroll-smooth">
<head>
    <!-- 1. Configurações Iniciais e Performance -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="theme-color" content="#1A3E74">

    <!-- Preconnect para recursos externos -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://auditeduca.github.io">

    <!-- 2. SEO e Metadados -->
    <title>Calculadoras de Enfermagem — Escalas Clínicas e Ferramentas</title>
    <meta name="description" content="Mais de 50 calculadoras e escalas clínicas para profissionais de enfermagem;">
    
    <!-- Favicon -->
    <link rel="icon" href="https://www.calculadorasdeenfermagem.com.br/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="https://www.calculadorasdeenfermagem.com.br/favicon.ico" type="image/x-icon">

    <!-- 3. CSS e Bibliotecas Críticas -->
    
    <!-- Three.js (Adicionado para corrigir 'THREE is not defined' no preload.js) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <!-- Tailwind CSS (Removido 'defer' para corrigir 'tailwind is not defined') -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: { extend: { colors: { primary: '#1A3E74', accent: '#1e40af' } } }
        }
    </script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" media="print" onload="this.media='all'">

    <!-- CSS Crítico Modular -->
    <link rel="stylesheet" href="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/css/preload.css">
    
    <!-- Estilos Globais e Controle de FOUC -->
    <style>
        :root {
            --primary: #1A3E74;
        }
        
        /* Controle de visibilidade da página (Evita FOUC) */
        .js-loading {
            visibility: hidden;
        }
        
        /* Placeholder para conteúdo principal */
        .content-placeholder {
            min-height: 400px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #f9fafb;
        }
        
        /* Visibilidade controlada dos elementos estruturais */
        body:not(.js-ready) header,
        body:not(.js-ready) main,
        body:not(.js-ready) footer {
            visibility: hidden;
        }
        
        body.js-ready header,
        body.js-ready main,
        body.js-ready footer {
            visibility: visible;
            transition: visibility 0.3s ease;
        }
    </style>
    
    <!-- Carregamento CSS Não-Crítico -->
    <link rel="stylesheet" href="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/css/global.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/css/global-main.css" media="print" onload="this.media='all'">
    
    <link rel="stylesheet" href="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/css/header.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/css/mega-menu-final.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/css/accessibility.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/css/footer.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/css/global-main-index.css" media="print" onload="this.media='all'">
    
    <noscript>
        <!-- Fallbacks CSS -->
        <link rel="stylesheet" href="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/css/global.css">
        <link rel="stylesheet" href="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/css/global-main.css">
        <link rel="stylesheet" href="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/css/preload.css">
    </noscript>

    <!-- Script de controle de estado -->
    <script>
        (function() {
            document.documentElement.classList.add('js-loading');
            window.addEventListener('AppReady', function() {
                document.documentElement.classList.remove('js-loading');
                document.body.classList.add('js-ready');
            });
            setTimeout(function() {
                document.documentElement.classList.remove('js-loading');
                document.body.classList.add('js-ready');
            }, 5000);
        })();
    </script>
</head>
<body class="bg-gray-50 text-gray-800 relative">

    <!-- 4. Componentes -->
    
    <!-- Container do Preloader -->
    <div id="preload-container"></div>

    <!-- Widgets de Acessibilidade -->
    <div id="accessibility-container"></div>
    <div vw class="enabled" style="display:none">
        <div vw-access-button class="active"></div>
        <div vw-plugin-wrapper><div class="vw-plugin-top-wrapper"></div></div>
    </div>

    <!-- Cabeçalho -->
    <header id="header-container" class="relative z-50"></header>

    <!-- Conteúdo Principal -->
    <main id="main-container" class="container mx-auto px-4 min-h-screen pt-4 md:pt-6 pb-12">
        <div id="main-content-placeholder" class="content-placeholder">
            <div class="text-center">
                <p class="text-primary font-medium mt-4" style="color: #1A3E74;">Carregando...</p>
            </div>
        </div>
    </main>

    <!-- Rodapé -->
    <footer id="footer-container" class="relative z-40"></footer>

    <!-- 5. Scripts de Orquestração -->
    
    <script>
        const APP_CONFIG = {
            baseUrl: "https://auditeduca.github.io/Calculadoras-de-Enfermagem/", 
            components: [
                { id: 'preload-container', url: 'assets/components/preload.html' },
                { id: 'accessibility-container', url: 'assets/components/accessibility.html' },
                { id: 'header-container', url: 'assets/components/header.html' },
                { id: 'footer-container', url: 'assets/components/footer.html' },
                { id: 'main-container', url: 'assets/pages/main-index.html' }
            ],
            scripts: [
                'assets/js/utils.js',
                'assets/js/console-cleaner.js',
                'assets/js/preload.js', 
                'assets/js/accessibility.js', 
                'assets/js/header.js',
                'assets/js/global-main.js',
                'assets/js/global-main-index.js',
                'assets/js/main-index-loader.js',
                'assets/js/footer.js'
            ]
        };
    </script>

    <!-- Loader Modular -->
    <script>
        class AppLoader {
            constructor(config) {
                this.config = config;
                this.init();
            }

            async init() {
                console.log('[AppLoader] Iniciando orquestração...');
                const start = performance.now();

                try {
                    await this.loadAllComponents();
                    this.showMainContent();
                    this.initVLibras();
                    await this.loadAllScripts();

                    const end = performance.now();
                    console.log(`[AppLoader] Completo em ${Math.round(end - start)}ms`);
                    
                    this.dispatchReadyEvents();
                    this.hidePreloader();

                } catch (error) {
                    console.error('[AppLoader] Erro:', error);
                    this.hidePreloader();
                }
            }

            showMainContent() {
                const placeholder = document.getElementById('main-content-placeholder');
                if (placeholder) {
                    placeholder.style.opacity = '0';
                    setTimeout(() => placeholder.style.display = 'none', 300);
                }
            }

            async fetchComponent(component) {
                const element = document.getElementById(component.id);
                if (!element) return;
                try {
                    const response = await fetch(this.config.baseUrl + component.url);
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    element.innerHTML = await response.text();
                } catch (err) {
                    console.error(`Erro ao carregar ${component.id}`);
                }
            }

            async loadAllComponents() {
                const promises = this.config.components.map(c => this.fetchComponent(c));
                await Promise.all(promises);
            }

            loadScript(src) {
                return new Promise((resolve) => {
                    const script = document.createElement('script');
                    script.src = this.config.baseUrl + src;
                    script.onload = () => resolve();
                    script.onerror = () => resolve();
                    document.head.appendChild(script);
                });
            }

            async loadAllScripts() {
                for (const src of this.config.scripts) await this.loadScript(src);
            }

            initVLibras() {
                if (!document.querySelector('script[src*="vlibras-plugin.js"]')) {
                    const script = document.createElement('script');
                    script.src = "https://vlibras.gov.br/app/vlibras-plugin.js";
                    script.onload = () => {
                        if (window.VLibras) new window.VLibras.Widget('https://vlibras.gov.br/app');
                    };
                    document.body.appendChild(script);
                }
            }

            dispatchReadyEvents() {
                window.dispatchEvent(new CustomEvent('AppReady'));
                window.dispatchEvent(new CustomEvent('ModulesLoaded'));
            }

            hidePreloader() {
                const container = document.getElementById('preload-container');
                if (!container) return;

                setTimeout(() => {
                    container.style.transition = 'opacity 0.5s ease';
                    container.style.opacity = '0';
                    container.style.pointerEvents = 'none';
                    setTimeout(() => {
                        container.style.display = 'none';
                        container.innerHTML = '';
                    }, 500);
                }, 500);
            }
        }
        document.addEventListener('DOMContentLoaded', () => new AppLoader(APP_CONFIG));
    </script>
</body>
</html>