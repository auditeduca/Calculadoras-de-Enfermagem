<!DOCTYPE html>
<html lang="pt-br" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Calculadora de Heparina - Dosagem e Diluição | Calculadoras de Enfermagem</title>

    <!-- [1. CONFIGURAÇÃO E CARREGAMENTO DE MÓDULOS] -->
    <script>
        window.NURSE_CONFIG = {
            baseUrl: 'https://auditeduca.github.io/Calculadoras-de-Enfermagem/',
            version: 'v4.8.1',
            lastUpdate: '24/01/2026'
        };

        async function loadModule(id, fileName) {
            const container = document.getElementById(id);
            if (!container) return;
            try {
                const response = await fetch(`${window.NURSE_CONFIG.baseUrl}assets/components/${fileName}.html`);
                if (!response.ok) throw new Error(`Erro: ${response.status}`);
                const html = await response.text();
                container.innerHTML = html;
                container.classList.remove('opacity-50', 'opacity-30');
                container.style.opacity = "1";
                window.dispatchEvent(new CustomEvent('moduleLoaded', { detail: { id, fileName } }));
            } catch (err) {
                console.error(`Falha no módulo ${fileName}:`, err);
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            loadModule('accessibility-container', 'accessibility-v4');
            loadModule('header-container', 'header-v4');
            loadModule('footer-container', 'footer-v4');

            // Delegação global para interatividade de módulos externos
            document.addEventListener('click', (e) => {
                const toggleBtn = e.target.closest('[data-toggle-menu]') || e.target.closest('.menu-toggle');
                if (toggleBtn) {
                    const menu = document.querySelector(toggleBtn.dataset.toggleMenu || '.mega-menu-container');
                    if (menu) menu.classList.toggle('hidden');
                }
                if (e.target.closest('#toggle-contrast') || e.target.closest('.btn-contrast')) {
                    document.documentElement.classList.toggle('dark');
                }
            });
        });
    </script>

    <!-- [2. RECURSOS EXTERNOS] -->
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <link rel="stylesheet" href="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/css/variables-v4.css">
    <link rel="stylesheet" href="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/css/header-v4.css">
    <link rel="stylesheet" href="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/css/footer-v4.css">
    <link rel="stylesheet" href="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/css/accessibility-v4.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@700;800;900&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { nunito: ['"Nunito Sans"', 'sans-serif'], inter: ['Inter', 'sans-serif'] },
                    colors: { 
                        'nurse-primary': '#1A3E74', 
                        'nurse-secondary': '#00bcd4',
                        'nurse-accent': '#00838f', 
                        'nurse-bgDark': '#0F172A' 
                    }
                }
            }
        }
    </script>

    <style type="text/tailwindcss">
        @layer base {
            body { @apply bg-slate-50 text-slate-900 dark:bg-nurse-bgDark dark:text-slate-100 antialiased font-inter transition-colors duration-300; }
            h1, h2, h3 { @apply font-nunito tracking-tight text-nurse-primary dark:text-cyan-400 font-black text-left; }
        }
        @layer components {
            .card-base { @apply bg-white dark:bg-slate-800/90 rounded-[2.5rem] border border-slate-200 dark:border-slate-700 shadow-sm transition-all overflow-hidden text-left; }
            .sidebar-module { @apply rounded-2xl p-6 shadow-lg text-white bg-gradient-to-br from-[#1A3E74] to-[#2E5A9C] dark:from-[#1e293b] dark:to-[#0f172a] mb-6 transition-all; }
            .input-field { @apply w-full bg-slate-50 dark:bg-slate-900 border-2 border-slate-100 dark:border-slate-700 rounded-xl px-4 py-3 focus:border-nurse-secondary outline-none transition-all font-semibold; }
            
            .btn-nurse-standard { @apply h-[60px] min-w-[200px] px-6 rounded-2xl font-bold transition-all active:scale-[0.98] flex items-center justify-center gap-3 text-sm shadow-md; }
            .btn-calc { @apply bg-nurse-primary text-white hover:bg-nurse-secondary w-full md:w-auto; }
            .btn-clear { @apply bg-white dark:bg-slate-700 border-2 border-slate-200 dark:border-slate-600 text-slate-500 w-full md:w-auto; }
            .btn-pdf { @apply bg-nurse-primary text-white hover:brightness-110 flex-grow md:flex-none; }
            .btn-copy { @apply bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-white flex-grow md:flex-none; }
            .btn-nanda { @apply bg-nurse-accent text-white hover:brightness-110 w-full md:w-auto; }

            .tab-btn { @apply flex-1 px-4 py-4 font-bold text-[11px] transition-all border-b-4 border-transparent text-slate-400 hover:text-nurse-primary whitespace-nowrap text-center; }
            .tab-btn.active { @apply border-nurse-secondary text-nurse-primary dark:text-cyan-400 bg-slate-50/50 dark:bg-slate-900/30; }
            
            .glass-meta { @apply relative backdrop-blur-md border border-white/20 p-6 rounded-2xl shadow-xl transition-all duration-300; }
            .glass-meta-blue { @apply bg-gradient-to-r from-blue-600 to-blue-500 text-white shadow-blue-500/20; }
            .glass-meta-orange { @apply bg-gradient-to-r from-orange-600 to-orange-500 text-white shadow-orange-500/20; }
            
            #notification-container { @apply fixed top-6 right-6 z-[10000] flex flex-col gap-3 pointer-events-none; }
            .toast-msg { @apply pointer-events-auto bg-slate-900 text-white px-6 py-4 rounded-2xl shadow-2xl flex items-center gap-4 font-bold text-sm min-w-[320px] border-l-4 border-nurse-secondary; animation: slide-in 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }

            .share-btn { @apply w-11 h-11 rounded-full flex items-center justify-center bg-white/10 text-white hover:bg-white hover:text-nurse-primary transition-all shadow-sm; }
        }
        @keyframes slide-in { from { transform: translateX(120%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        #pdf-render-template { position: absolute; left: -9999px; top: 0; width: 794px; min-height: 1123px; background: white; padding: 40px; color: #0f172a; display: flex; flex-direction: column; }
    </style>
</head>
<body class="flex flex-col min-h-screen relative overflow-x-hidden">

    <div id="notification-container"></div>
    <div id="accessibility-container"></div>
    <div id="header-container" class="sticky top-0 z-50 bg-white dark:bg-nurse-bgDark min-h-[70px] transition-opacity duration-500 opacity-50"></div>

    <main id="main-content" class="flex-grow max-w-7xl mx-auto px-4 py-8 md:py-12 w-full">
        
        <!-- Breadcrumb -->
        <nav class="flex items-center gap-2 text-sm text-slate-600 dark:text-cyan-300 mb-8 font-semibold no-print" aria-label="Breadcrumb">
            <a href="index.html" class="hover:underline text-nurse-accent">Início</a>
            <i class="fa-solid fa-chevron-right text-[10px]"></i>
            <a href="ferramentas.html" class="hover:underline text-nurse-accent">Ferramentas</a>
            <i class="fa-solid fa-chevron-right text-[10px]"></i>
            <a href="calculadoras.html" class="hover:underline text-nurse-accent">Calculadoras Clínicas</a>
            <i class="fa-solid fa-chevron-right text-[10px]"></i>
            <span class="text-nurse-primary dark:text-cyan-400 font-bold" aria-current="page">Cálculo de Heparina</span>
        </nav>

        <header class="max-w-4xl mb-12 text-left">
            <span class="bg-nurse-primary text-white text-[11px] font-bold px-4 py-2 rounded-full uppercase tracking-widest mb-4 inline-block shadow-md">Calculadoras Clínicas</span>
            <h1 class="text-4xl md:text-5xl lg:text-6xl mb-6 leading-tight">Cálculo de Heparina</h1>
            <div class="w-24 h-2 bg-gradient-to-r from-nurse-accent to-nurse-primary rounded-full mb-8"></div>
            <p class="text-xl text-slate-700 dark:text-slate-300 font-medium italic text-balance text-left">Segurança e precisão na administração de anticoagulantes para a prática de enfermagem.</p>
        </header>

        <div class="grid lg:grid-cols-[1fr,340px] gap-10 lg:gap-16 items-start">
            
            <div class="space-y-12">
                <article class="card-base shadow-2xl">
                    <nav class="flex border-b border-slate-100 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-900/30 no-print text-left">
                        <button onclick="switchTab('calc')" id="btn-tab-calc" class="tab-btn active">Calculadora</button>
                        <button onclick="switchTab('sobre')" id="btn-tab-sobre" class="tab-btn">Sobre</button>
                        <button onclick="switchTab('ajuda')" id="btn-tab-ajuda" class="tab-btn">Como usar?</button>
                        <button onclick="switchTab('tecnico')" id="btn-tab-tecnico" class="tab-btn">Técnico</button>
                    </nav>

                    <div class="p-8 md:p-12">
                        <!-- PANE: CALCULADORA -->
                        <section id="pane-calc" class="tab-pane space-y-12">
                            <div class="space-y-8">
                                <div class="bg-slate-50/50 dark:bg-slate-900/40 p-8 rounded-3xl border border-slate-100 dark:border-slate-800">
                                    <h3 class="text-xs font-black uppercase tracking-widest mb-6 flex items-center gap-3">
                                        <i class="fa-solid fa-user-circle text-nurse-secondary text-lg"></i> Dados do paciente
                                    </h3>
                                    <div class="grid md:grid-cols-2 gap-6">
                                        <div class="space-y-2">
                                            <label class="text-[10px] font-black uppercase text-slate-400 ml-1">Nome completo</label>
                                            <input id="patient_name" type="text" placeholder="Nome do paciente" class="input-field">
                                        </div>
                                        <div class="space-y-2">
                                            <label class="text-[10px] font-black uppercase text-slate-400 ml-1">Data de Nascimento</label>
                                            <input id="patient_birthdate" type="date" class="input-field" oninput="validateBirthDate()" max="9999-12-31">
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-slate-50/50 dark:bg-slate-900/40 p-8 rounded-3xl border border-slate-100 dark:border-slate-800">
                                    <h3 class="text-xs font-black uppercase tracking-widest mb-6 flex items-center gap-3">
                                        <i class="fa-solid fa-vial text-nurse-secondary text-lg"></i> Parâmetros do cálculo <span class="text-red-500 font-black">*</span>
                                    </h3>
                                    <div class="grid md:grid-cols-3 gap-6">
                                        <div class="space-y-2">
                                            <label class="text-[10px] font-black uppercase text-slate-400 ml-1">Concentração (UI)</label>
                                            <input id="heparinaConcentracao" type="number" min="0" placeholder="5000" class="input-field font-bold text-nurse-primary dark:text-cyan-400" onkeydown="preventNegative(event)">
                                        </div>
                                        <div class="space-y-2">
                                            <label class="text-[10px] font-black uppercase text-slate-400 ml-1">Volume Frasco (ml)</label>
                                            <input id="heparinaVolume" type="number" step="0.1" min="0" placeholder="5" class="input-field font-bold" onkeydown="preventNegative(event)">
                                        </div>
                                        <div class="space-y-2">
                                            <label class="text-[10px] font-black uppercase text-slate-400 ml-1">Prescrição (UI)</label>
                                            <input id="heparinaPrescricao" type="number" min="0" placeholder="2500" class="input-field font-bold" onkeydown="preventNegative(event)">
                                        </div>
                                    </div>
                                    <div class="flex flex-wrap gap-4 mt-10">
                                        <button onclick="calcularHeparina()" class="btn-nurse-standard btn-calc"><i class="fa-solid fa-calculator"></i> Calcular</button>
                                        <button onclick="resetForm()" class="btn-nurse-standard btn-clear"><i class="fa-solid fa-rotate-left"></i> Limpar</button>
                                    </div>
                                </div>
                            </div>

                            <!-- RESULTADOS -->
                            <div id="results-wrapper" class="hidden space-y-12 animate-fade-in">
                                <div class="bg-white dark:bg-slate-800 rounded-[2.5rem] p-10 md:p-16 border-2 border-nurse-primary/10 shadow-2xl text-center relative overflow-hidden">
                                    <span class="absolute top-6 left-8 text-[11px] font-black uppercase text-nurse-primary/30 tracking-widest">Resultado</span>
                                    <div class="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-nurse-accent via-nurse-primary to-nurse-accent"></div>
                                    <p class="text-[10px] text-slate-400 font-black uppercase tracking-[0.3em] mb-4 text-center">Volume total a aspirar</p>
                                    <div id="res-total" class="text-7xl md:text-9xl font-black text-[#1A3E74] dark:text-cyan-400 tracking-tighter font-nunito leading-none text-center">0,00</div>
                                    <p class="text-xl font-black text-nurse-secondary mt-4 uppercase tracking-widest text-center">Mililitros (ml)</p>
                                    <div id="res-formula-box" class="mt-10 inline-block px-8 py-4 bg-slate-50 dark:bg-slate-900/50 rounded-2xl font-mono text-xs border border-slate-100 dark:border-slate-700 text-slate-500 shadow-inner italic"></div>
                                    <div id="res-conduta" class="mt-6 text-center"></div>
                                    <div class="mt-12 flex flex-wrap gap-4 justify-center">
                                        <button onclick="gerarPDF()" class="btn-nurse-standard btn-pdf"><i class="fa-solid fa-file-pdf"></i> Gerar PDF</button>
                                        <button onclick="copiarResumo()" class="btn-nurse-standard btn-copy"><i class="fa-solid fa-copy"></i> Copiar</button>
                                    </div>
                                </div>

                                <!-- PLANO DIAGNÓSTICO -->
                                <section class="bg-slate-50 dark:bg-slate-900/40 p-12 rounded-[2.5rem] border border-slate-200 dark:border-slate-700 shadow-inner text-left">
                                    <h3 class="text-[11px] font-black uppercase tracking-widest mb-8 flex items-center gap-3">
                                        <i class="fa-solid fa-notes-medical text-lg"></i> Plano diagnóstico de enfermagem
                                    </h3>
                                    <button onclick="showNanda()" class="btn-nurse-standard btn-nanda"><i class="fa-solid fa-book-medical"></i> Nanda/nic/noc</button>
                                </section>

                                <!-- AUDITORIA -->
                                <div class="bg-white dark:bg-slate-900/40 p-10 rounded-[2.5rem] border border-slate-200 dark:border-slate-800 shadow-sm font-inter text-left">
                                    <h3 class="text-xs font-black uppercase tracking-widest mb-10 flex items-center gap-3 text-left">
                                        <i class="fa-solid fa-clipboard-check text-xl"></i> Auditoria do cálculo
                                    </h3>
                                    <ul class="space-y-4 text-left">
                                        <li class="flex items-center gap-5 p-5 bg-slate-50 dark:bg-slate-800/60 rounded-2xl border border-slate-100 dark:border-slate-700 transition hover:border-nurse-secondary">
                                            <div class="w-12 h-12 rounded-xl bg-nurse-primary/5 flex items-center justify-center text-nurse-primary"><i class="fa-solid fa-user-tag"></i></div>
                                            <div class="flex-grow">
                                                <p class="text-[10px] font-black uppercase text-slate-400 tracking-tighter">Dados do Paciente</p>
                                                <p class="text-sm font-bold text-slate-700 dark:text-slate-200"><span id="audit-nome">---</span> • <span id="audit-nasc">---</span></p>
                                            </div>
                                        </li>
                                        <li class="flex items-center gap-5 p-5 bg-slate-50 dark:bg-slate-800/60 rounded-2xl border border-slate-100 dark:border-slate-700 transition hover:border-nurse-secondary">
                                            <div class="w-12 h-12 rounded-xl bg-nurse-primary/5 flex items-center justify-center text-nurse-primary"><i class="fa-solid fa-sliders"></i></div>
                                            <div class="flex-grow">
                                                <p class="text-[10px] font-black uppercase text-slate-400 tracking-tighter">Parâmetros Informados</p>
                                                <p class="text-sm font-bold text-slate-700 dark:text-slate-200">Prescrição: <span id="audit-presc">---</span> | Frasco: <span id="audit-frasco">---</span></p>
                                            </div>
                                        </li>
                                        <li class="flex items-center gap-5 p-5 bg-nurse-primary/5 dark:bg-nurse-primary/20 rounded-2xl border-2 border-dashed border-nurse-primary/20">
                                            <div class="w-12 h-12 rounded-xl bg-nurse-primary/10 flex items-center justify-center text-nurse-primary"><i class="fa-solid fa-square-root-variable"></i></div>
                                            <div class="flex-grow">
                                                <p class="text-[10px] font-black uppercase text-nurse-primary dark:text-cyan-400 tracking-tighter">Memória de Cálculo</p>
                                                <p id="audit-math-detail" class="font-mono text-sm font-black text-nurse-primary dark:text-slate-200 italic">Aguardando...</p>
                                            </div>
                                        </li>
                                    </ul>
                                </div>

                                <!-- CHECKLISTS -->
                                <div class="space-y-10 font-inter text-left">
                                    <h2 class="text-2xl font-black text-center flex items-center justify-center gap-4">
                                        <i class="fa-solid fa-shield-halved text-nurse-secondary text-3xl"></i> Check-list de Segurança do Paciente
                                    </h2>
                                    <div class="grid grid-cols-1 gap-12 text-left">
                                        <div class="space-y-8 text-left">
                                            <h3 class="text-xs font-black uppercase tracking-widest flex items-center gap-3 border-b border-slate-100 dark:border-slate-800 pb-4">
                                                <i class="fa-solid fa-list-check text-lg"></i> 9 acertos de medicamentos
                                            </h3>
                                            <div id="checklist-9certos" class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-left"></div>
                                        </div>
                                        <div class="space-y-8 text-left">
                                            <h3 class="text-xs font-black uppercase tracking-widest flex items-center gap-3 border-b border-slate-100 dark:border-slate-800 pb-4">
                                                <i class="fa-solid fa-globe text-lg"></i> Metas de segurança
                                            </h3>
                                            <div id="checklist-metas" class="flex flex-col gap-4 text-left"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <section id="pane-sobre" class="tab-pane hidden prose prose-slate dark:prose-invert max-w-none text-left">
                            <h2 class="text-3xl font-black mb-6">Sobre a ferramenta</h2>
                            <p class="text-lg">Focada na mitigação de erros em medicamentos de alta vigilância, esta ferramenta utiliza protocolos da OMS e do MS para garantir a segurança assistencial.</p>
                        </section>

                        <section id="pane-ajuda" class="tab-pane hidden prose prose-slate dark:prose-invert max-w-none text-left">
                            <h2 class="text-3xl font-black mb-6 text-left">Como usar a calculadora?</h2>
                            <ol class="space-y-4 text-left">
                                <li><strong>Identificação:</strong> Insira o nome do paciente e data de nascimento (opcional).</li>
                                <li><strong>Parâmetros:</strong> Informe a concentração (ex: 5000 UI), o volume (ex: 5ml) e a dose prescrita.</li>
                                <li><strong>Cálculo:</strong> Clique em "Calcular" para obter o volume em ml.</li>
                                <li><strong>Conferência:</strong> Revise os 9 Acertos e as Metas de Segurança antes do preparo.</li>
                                <li><strong>Registo:</strong> Gere o PDF para documentação clínica obrigatória.</li>
                            </ol>
                        </section>

                        <section id="pane-tecnico" class="tab-pane hidden prose prose-slate dark:prose-invert max-w-none text-left">
                            <h2 class="text-3xl font-black mb-6 text-left">Informações Técnicas</h2>
                            <div class="p-4 bg-slate-100 dark:bg-slate-800 rounded-xl text-sm text-left">
                                <p><strong>Versão:</strong> 4.8.1 | <strong>Atualização:</strong> 24/01/2026</p>
                                <p><strong>Referências:</strong> Protocolo Nacional de Segurança do Paciente (MS), OMS 2024, NANDA-I 2021-2023.</p>
                            </div>
                        </section>
                    </div>
                </article>

                <!-- AUTOR -->
                <section class="card-base bg-slate-100 dark:bg-slate-900/60 p-10 flex flex-col md:flex-row gap-8 items-center border border-slate-200 dark:border-slate-700 no-print text-left">
                    <img src="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/images/author-info.webp" alt="Autor" class="w-24 h-24 rounded-full border-4 border-white shadow-xl object-cover">
                    <div class="text-center md:text-left">
                        <h3 class="text-2xl font-black mb-1 text-nurse-primary dark:text-cyan-400 font-nunito">Calculadoras de Enfermagem</h3>
                        <p class="text-slate-600 dark:text-slate-300 text-md italic font-medium font-inter">"A precisão técnica é a expressão máxima do cuidado ético ao paciente."</p>
                    </div>
                </section>
            </div>

            <aside class="space-y-8 sticky top-32 self-start hidden lg:block no-print text-left">
                <!-- Desafio Clínico CTA -->
                <div class="sidebar-module from-[#0ea5e9] to-[#0369a1] text-center">
                    <h3 class="border-b-2 border-white/20 pb-4 mb-5 font-bold flex items-center justify-center gap-3 text-xl text-white font-nunito"><i class="fa-solid fa-trophy"></i> Desafio Clínico</h3>
                    <p class="text-sm text-white/95 mb-6 font-medium leading-relaxed">Domine a segurança do paciente! Teste sua agilidade em casos reais com nossos simulados interativos.</p>
                    <button onclick="redirectSimulados()" class="inline-flex items-center justify-center gap-2 px-6 py-4 rounded-2xl bg-white text-nurse-primary font-black hover:bg-nurse-secondary hover:text-white transition w-full shadow-2xl hover:scale-[1.05] duration-300">Acessar Simulados Agora <i class="fa-solid fa-bolt"></i></button>
                </div>

                <!-- Compartilhar Section -->
                <div class="sidebar-module from-teal-700 to-nurse-secondary shadow-nurse-accent/20 text-center">
                    <h3 class="border-b-2 border-white/20 pb-4 mb-5 font-bold flex items-center justify-center gap-3 text-xl text-white font-nunito"><i class="fas fa-share-alt"></i> Compartilhar</h3>
                    <div class="grid grid-cols-5 gap-2">
                        <button class="share-btn" title="Facebook" onclick="share('facebook')"><i class="fab fa-facebook-f"></i></button>
                        <button class="share-btn" title="WhatsApp" onclick="share('whatsapp')"><i class="fab fa-whatsapp"></i></button>
                        <button class="share-btn" title="Instagram" onclick="share('instagram')"><i class="fab fa-instagram"></i></button>
                        <button class="share-btn" title="LinkedIn" onclick="share('linkedin')"><i class="fab fa-linkedin-in"></i></button>
                        <button class="share-btn" title="Copiar Link" onclick="copyLink()"><i class="fas fa-link"></i></button>
                    </div>
                </div>
            </aside>
        </div>

        <!-- TAGS -->
        <section class="mt-16 flex flex-wrap gap-2 items-center no-print text-left">
            <span class="text-xs font-bold text-slate-400 uppercase tracking-widest mr-2 flex items-center font-inter"><i class="fa-solid fa-tags mr-2"></i> Tópicos:</span>
            <span class="tag-pill">#Enfermagem</span><span class="tag-pill">#Heparina</span><span class="tag-pill">#CalculadorasClínicas</span><span class="tag-pill">#SegurançaDoPaciente</span>
        </section>

        <!-- CONTEÚDO RELACIONADO -->
        <section class="mt-24 no-print border-t border-slate-200 dark:border-slate-800 pt-16 text-center text-left">
            <h2 class="text-3xl font-black mb-12 inline-flex items-center gap-4 font-nunito mx-auto text-center"><i class="fa-solid fa-layer-group text-nurse-accent"></i> Conteúdo relacionado</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 items-stretch text-left">
                <div class="card-base p-8 flex flex-col group hover:shadow-2xl hover:-translate-y-2 transition-all duration-500 text-left">
                    <span class="text-[9px] font-black bg-nurse-primary/10 text-nurse-primary px-3 py-1 rounded-full uppercase mb-4 self-start">Calculadoras Clínicas</span>
                    <i class="fa-solid fa-syringe text-3xl text-nurse-primary mb-6 text-left"></i>
                    <h3 class="text-xl font-black mb-3 text-left">Cálculo de Insulina</h3>
                    <p class="text-slate-500 text-sm mb-8 flex-grow text-left">Conversão correta de UI para seringas de 1ml com segurança absoluta.</p>
                    <a href="insulina.html" class="btn-nurse-standard h-[50px] min-w-0 bg-nurse-primary text-white text-xs shadow-none">Acessar ferramenta <i class="fa-solid fa-chevron-right text-[10px]"></i></a>
                </div>
                <div class="card-base p-8 flex flex-col group hover:shadow-2xl hover:-translate-y-2 transition-all duration-500 text-left">
                    <span class="text-[9px] font-black bg-nurse-primary/10 text-nurse-primary px-3 py-1 rounded-full uppercase mb-4 self-start">Calculadoras Clínicas</span>
                    <i class="fa-solid fa-droplet text-3xl text-nurse-secondary mb-6 text-left"></i>
                    <h3 class="text-xl font-black mb-3 text-left">Gotejamento de Soro</h3>
                    <p class="text-slate-500 text-sm mb-8 flex-grow text-left">Calcule gotas e microgotas para infusões precisas e seguras.</p>
                    <a href="gotejamento.html" class="btn-nurse-standard h-[50px] min-w-0 bg-nurse-primary text-white text-xs shadow-none">Acessar ferramenta <i class="fa-solid fa-chevron-right text-[10px]"></i></a>
                </div>
                <div class="card-base p-8 flex flex-col group hover:shadow-2xl hover:-translate-y-2 transition-all duration-500 text-left">
                    <span class="text-[9px] font-black bg-nurse-primary/10 text-nurse-primary px-3 py-1 rounded-full uppercase mb-4 self-start">Calculadoras Clínicas</span>
                    <i class="fa-solid fa-chart-bar text-3xl text-nurse-accent mb-6 text-left"></i>
                    <h3 class="text-xl font-black mb-3 text-left">Balanço Hídrico</h3>
                    <p class="text-slate-500 text-sm mb-8 flex-grow text-left">Monitorização rigorosa de entradas e saídas de líquidos assistenciais.</p>
                    <a href="balanco-hidrico.html" class="btn-nurse-standard h-[50px] min-w-0 bg-nurse-primary text-white text-xs shadow-none">Acessar ferramenta <i class="fa-solid fa-chevron-right text-[10px]"></i></a>
                </div>
            </div>
        </section>
    </main>

    <div id="footer-container" class="relative z-10 bg-nurse-primary dark:bg-slate-900 min-h-[150px] mt-12 transition-opacity duration-500"></div>

    <!-- PDF TEMPLATE -->
    <div id="pdf-render-template">
        <div style="flex: 1; display: flex; flex-direction: column;">
            <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid #1A3E74; padding-bottom: 10px; margin-bottom: 20px;">
                <img src="https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/images/author-info.webp" style="height: 50px;" alt="Logo"/>
                <div style="text-align: right;">
                    <h1 style="font-family: 'Nunito Sans', sans-serif; font-size: 18px; color: #1A3E74; margin: 0; font-weight: 900; text-transform: uppercase;">Registro de Aspiração de Heparina</h1>
                    <p style="font-size: 9px; color: #64748b; margin: 0; font-weight: 600;">CALCULADORAS CLÍNICAS - ENFERMAGEM</p>
                </div>
            </div>
            <div id="pdf-body" style="font-size: 10px; font-family: 'Inter', sans-serif; flex: 1;"></div>
        </div>
        <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: flex-end;">
            <div style="font-size: 8px; color: #94a3b8;"><p id="pdf-footer-timestamp" style="margin: 0; font-weight: 700;"></p></div>
            <div id="pdf-qrcode-container" style="width: 60px; height: 60px;"></div>
        </div>
    </div>

    <script>
        // [MODULO: CONSTANTES]
        const CONSTS = {
            CERTOS: ["Paciente certo", "Medicamento certo", "Dose certa", "Via certa", "Hora certa", "Registro certo", "Orientação certa", "Resposta certa", "Validade certa"],
            METAS: [
                { id: 1, text: "Identificar corretamente o paciente", class: "glass-meta-blue" },
                { id: 3, text: "Segurança de medicamentos de alta vigilância", class: "glass-meta-orange" }
            ]
        };

        // [MODULO: UTILITÁRIOS]
        const safeSet = (id, val, isHTML = false) => {
            const el = document.getElementById(id);
            if (el) el[isHTML ? 'innerHTML' : 'innerText'] = val;
        };

        function showNotification(msg) {
            const container = document.getElementById('notification-container');
            if (!container) return;
            const toast = document.createElement('div');
            toast.className = 'toast-msg';
            toast.innerHTML = `<i class="fa-solid fa-circle-info text-nurse-secondary text-lg"></i><span>${msg}</span>`;
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(50px)';
                setTimeout(() => toast.remove(), 500);
            }, 3500);
        }

        // [MODULO: INTERFACE E ESTADO]
        function switchTab(tabId) {
            document.querySelectorAll('.tab-pane').forEach(p => p.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`pane-${tabId}`)?.classList.remove('hidden');
            document.getElementById(`btn-tab-${tabId}`)?.classList.add('active');
            
            const results = document.getElementById('results-wrapper');
            if (results) results.classList.toggle('hidden', tabId !== 'calc' || !window.__calc_data);
        }

        function validateBirthDate() {
            const el = document.getElementById('patient_birthdate');
            if (!el?.value) return;
            const parts = el.value.split('-');
            if (parts[0] && parts[0].length > 4) {
                parts[0] = parts[0].substring(0, 4);
                el.value = parts.join('-');
            }
        }

        function preventNegative(e) { if (['-', 'e', '+'].includes(e.key)) e.preventDefault(); }

        // [MODULO: LÓGICA DE NEGÓCIO]
        function calcularHeparina() {
            const data = {
                name: document.getElementById('patient_name')?.value || "Não Identificado",
                dob: document.getElementById('patient_birthdate')?.value || "Não Informada",
                conc: parseFloat(document.getElementById('heparinaConcentracao')?.value),
                vol: parseFloat(document.getElementById('heparinaVolume')?.value),
                presc: parseFloat(document.getElementById('heparinaPrescricao')?.value)
            };

            if (isNaN(data.conc) || isNaN(data.vol) || isNaN(data.presc)) {
                showNotification("Atenção: preencha os parâmetros obrigatórios!");
                return;
            }

            const resultVal = (data.presc * data.vol) / data.conc;
            const formatted = resultVal.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            
            window.__calc_data = { ...data, result: formatted, timestamp: new Date().toLocaleString() };
            atualizarInterfaceInterface(window.__calc_data, resultVal);
            
            const wrapper = document.getElementById('results-wrapper');
            wrapper.classList.remove('hidden');
            wrapper.scrollIntoView({ behavior: 'smooth' });
            showNotification("Resultado gerado com sucesso!");
        }

        function atualizarInterfaceInterface(d, rawResult) {
            safeSet('res-total', d.result);
            safeSet('res-formula-box', `Fórmula aplicada: (${d.presc} UI * ${d.vol} ml) / ${d.conc} UI`, true);
            safeSet('res-conduta', rawResult > 10 ? `<p class="text-red-500 font-black uppercase text-xs animate-pulse mt-4"><i class="fa-solid fa-triangle-exclamation"></i> Volume crítico detectado!</p>` : '', true);

            safeSet('audit-nome', d.name);
            safeSet('audit-nasc', d.dob);
            safeSet('audit-presc', `${d.presc} UI`);
            safeSet('audit-frasco', `${d.conc} UI / ${d.vol} ml`);
            safeSet('audit-math-detail', `(${d.presc} * ${d.vol}) / ${d.conc} = ${d.result} ml`);

            safeSet('checklist-9certos', CONSTS.CERTOS.map(c => `
                <label class="flex items-center gap-4 p-4 bg-white dark:bg-slate-800 rounded-xl border border-slate-100 cursor-pointer hover:border-nurse-secondary transition duration-300">
                    <input type="checkbox" class="w-5 h-5 accent-nurse-primary"><span class="text-xs font-bold">${c}</span>
                </label>`).join(''), true);

            safeSet('checklist-metas', CONSTS.METAS.map(m => `
                <label class="flex items-center gap-5 glass-meta ${m.class} cursor-pointer">
                    <input type="checkbox" class="w-6 h-6 accent-white shrink-0"><span class="text-xs font-black uppercase">${m.id}. ${m.text}</span>
                </label>`).join(''), true);
        }

        function resetForm() {
            ['patient_name', 'patient_birthdate', 'heparinaConcentracao', 'heparinaVolume', 'heparinaPrescricao'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.value = '';
            });
            document.getElementById('results-wrapper')?.classList.add('hidden');
            window.__calc_data = null;
            showNotification("Formulário limpo!");
        }

        // [MODULO: EXPORTAÇÃO E EXTERNOS]
        function showNanda() {
            showNotification("A pesquisar diagnósticos de enfermagem...");
            window.open(`https://www.google.com/search?q=${encodeURIComponent('NANDA NIC NOC Heparina diagnósticos enfermagem')}`, '_blank');
        }

        async function gerarPDF() {
            if (!window.__calc_data) return;
            showNotification("A gerar o PDF do registro clínico...");
            const c = window.__calc_data;
            const template = document.getElementById('pdf-render-template');
            safeSet('pdf-footer-timestamp', `Data: ${c.timestamp}`);
            safeSet('pdf-body', `
                <div style="padding: 20px; background: #f8fafc; border-radius: 12px; border: 1px solid #e2e8f0; margin-bottom: 20px; font-size:11px;">
                    <p>Paciente: <strong>${c.name}</strong> | Nasc: <strong>${c.dob}</strong></p>
                </div>
                <div style="padding: 25px; border: 2px solid #1A3E74; border-radius: 20px;">
                    <p style="text-align: center; font-weight: 900; text-transform: uppercase; border-bottom: 1px solid #e2e8f0; padding-bottom: 10px; margin-bottom: 15px;">Conferência Técnica</p>
                    <table style="width: 100%; font-size: 11px;">
                        <tr><td>Prescrição:</td><td style="text-align: right; font-weight: 800;">${c.presc} UI</td></tr>
                        <tr><td>Frasco:</td><td style="text-align: right; font-weight: 800;">${c.conc} UI / ${c.vol} ml</td></tr>
                        <tr style="font-size: 16px; font-weight: 900; color: #1A3E74; border-top: 2px solid #1A3E74;">
                            <td style="padding-top: 15px;">VOLUME A ASPIRAR:</td><td style="text-align: right; padding-top: 15px;">${c.result} ml</td>
                        </tr>
                    </table>
                </div>`, true);

            const qrContainer = document.getElementById('pdf-qrcode-container');
            if (qrContainer) { qrContainer.innerHTML = ''; new QRCode(qrContainer, { text: window.location.href, width: 60, height: 60 }); }
            
            try {
                const canvas = await html2canvas(template, { scale: 2, useCORS: true });
                const doc = new window.jspdf.jsPDF('p', 'pt', 'a4');
                doc.addImage(canvas.toDataURL('image/png'), 'PNG', 0, 0, doc.internal.pageSize.getWidth(), (canvas.height * doc.internal.pageSize.getWidth()) / canvas.width);
                doc.save(`Registro-Heparina-${c.name.replace(/\s+/g, '-')}.pdf`);
            } catch (err) { console.error(err); }
        }

        function copiarResumo() {
            if (!window.__calc_data) return;
            const c = window.__calc_data;
            const text = `REGISTRO DE HEPARINA\nPaciente: ${c.name}\nResultado: ${c.result} ml\n${c.timestamp}`;
            const el = document.createElement("textarea");
            el.value = text; document.body.appendChild(el); el.select();
            document.execCommand('copy'); document.body.removeChild(el);
            showNotification("Resumo copiado!");
        }

        function redirectSimulados() {
            showNotification("A redirecionar para Simulados para Enfermagem...");
            setTimeout(() => window.open('https://simulados-para-enfermagem.com.br/', '_blank'), 1200);
        }

        function share(platform) {
            const url = encodeURIComponent(window.location.href);
            const shares = { 
                whatsapp: `https://api.whatsapp.com/send?text=${url}`, 
                facebook: `https://www.facebook.com/sharer/sharer.php?u=${url}`, 
                linkedin: `https://www.linkedin.com/sharing/share-offsite/?url=${url}`,
                instagram: `https://www.instagram.com/` // Redireciona para o IG pois não há API de share via URL para stories/feed web
            };
            if (shares[platform]) window.open(shares[platform], '_blank');
        }

        function copyLink() {
            const el = document.createElement("textarea");
            el.value = window.location.href; document.body.appendChild(el); el.select();
            document.execCommand('copy'); document.body.removeChild(el);
            showNotification("Link copiado com sucesso!");
        }
    </script>
</body>
</html>