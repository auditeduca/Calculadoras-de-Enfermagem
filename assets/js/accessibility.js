window.AccessControl=window.AccessControl||(function(){"use strict";const state={fontSize:0,fontStyle:0,letterSpacing:0,lineHeight:0,readingMask:0,readingGuide:0,contrast:0,colorblind:0,saturation:0,bigCursor:0,ttsSpeed:0,ttsActive:false,stopSounds:false,magnifierActive:false,theme:"system",_initialized:false};let elements={};let mouseMoveHandler=null;let readingGuideHandler=null;let magnifierHandler=null;let ttsClickHandler=null;let glossaryData=[];function debounce(fn){let t;return function(...a){cancelAnimationFrame(t);t=requestAnimationFrame(()=>fn.apply(this,a))}}function sanitizeHTML(s){const d=document.createElement("div");d.textContent=s;return d.innerHTML}function announceToSR(m){let a=document.getElementById("sr-announcer");if(!a){a=document.createElement("div");a.id="sr-announcer";a.setAttribute("role","status");a.setAttribute("aria-live","polite");a.setAttribute("aria-atomic","true");a.className="sr-only";document.body.appendChild(a)}a.textContent="";setTimeout(()=>{a.textContent=m},100)}const displayNames={fontSize:{"1.2":"120%","1.5":"150%","2.0":"200%"},fontStyle:{atkinson:"Atkinson",newsreader:"Newsreader",opendyslexic:"OpenDyslexic"},lineHeight:{"1.2":"120%","1.5":"150%","2.0":"200%"},letterSpacing:{"1.2":"120%","1.5":"150%","2.0":"200%"},contrast:{inverted:"Invertido","dark-contrast":"Escuro","light-contrast":"Claro"},colorblind:{deuteranopia:"Verde",protanopia:"Vermelho",tritanopia:"Azul"},saturation:{low:"Baixa",high:"Alta",monochrome:"Mono"},readingMask:{sm:"Pequeno",md:"Médio",lg:"Grande"},readingGuide:{azul:"Azul",laranja:"Laranja",preto:"Preto"},bigCursor:{medium:"120%",large:"150%",xlarge:"200%"},tts:{normal:"Normal",slow:"Lento",fast:"Rápido"}};const allClasses=["inverted","dark-contrast","light-contrast","protanopia","deuteranopia","tritanopia","saturation-low","saturation-high","monochrome","highlight-links","highlight-headers","bold-text","stop-anim","stop-sounds","hide-images","font-atkinson","font-newsreader","font-opendyslexic","reading-mode","glossary","magnifier-active","reading-guide-azul","reading-guide-laranja","reading-guide-preto","big-cursor-medium","big-cursor-large","big-cursor-xlarge"];const shortcutsByBrowser={chrome:[{keys:["Alt","A"],desc:"Abrir/Fechar menu acessibilidade"},{keys:["Alt","1"],desc:"Aumentar fonte"},{keys:["Alt","2"],desc:"Diminuir fonte"},{keys:["Alt","C"],desc:"Alto contraste"},{keys:["Alt","L"],desc:"Destacar links"},{keys:["Alt","H"],desc:"Destacar cabeçalhos"},{keys:["Alt","M"],desc:"Máscara de leitura"},{keys:["Alt","G"],desc:"Guia de leitura"},{keys:["Alt","R"],desc:"Modo leitura"},{keys:["Alt","T"],desc:"Leitor TTS"},{keys:["Alt","I"],desc:"Esconder imagens"},{keys:["Alt","0"],desc:"Restaurar tudo"},{keys:["Esc"],desc:"Fechar painéis"}],firefox:[{keys:["Alt","Shift","A"],desc:"Abrir/Fechar menu acessibilidade"},{keys:["Alt","Shift","1"],desc:"Aumentar fonte"},{keys:["Alt","Shift","2"],desc:"Diminuir fonte"},{keys:["Alt","Shift","C"],desc:"Alto contraste"},{keys:["Alt","Shift","L"],desc:"Destacar links"},{keys:["Alt","Shift","H"],desc:"Destacar cabeçalhos"},{keys:["Alt","Shift","M"],desc:"Máscara de leitura"},{keys:["Alt","Shift","G"],desc:"Guia de leitura"},{keys:["Alt","Shift","R"],desc:"Modo leitura"},{keys:["Alt","Shift","T"],desc:"Leitor TTS"},{keys:["Alt","Shift","I"],desc:"Esconder imagens"},{keys:["Alt","Shift","0"],desc:"Restaurar tudo"},{keys:["Esc"],desc:"Fechar painéis"}],safari:[{keys:["Ctrl","Option","A"],desc:"Abrir/Fechar menu acessibilidade"},{keys:["Ctrl","Option","1"],desc:"Aumentar fonte"},{keys:["Ctrl","Option","2"],desc:"Diminuir fonte"},{keys:["Ctrl","Option","C"],desc:"Alto contraste"},{keys:["Ctrl","Option","L"],desc:"Destacar links"},{keys:["Ctrl","Option","H"],desc:"Destacar cabeçalhos"},{keys:["Ctrl","Option","M"],desc:"Máscara de leitura"},{keys:["Ctrl","Option","G"],desc:"Guia de leitura"},{keys:["Ctrl","Option","R"],desc:"Modo leitura"},{keys:["Ctrl","Option","T"],desc:"Leitor TTS"},{keys:["Ctrl","Option","I"],desc:"Esconder imagens"},{keys:["Ctrl","Option","0"],desc:"Restaurar tudo"},{keys:["Esc"],desc:"Fechar painéis"}]};const ThemeManager={detectSystemTheme(){return window.matchMedia?.("(prefers-color-scheme: dark)").matches?"dark":"light"},getTheme(){return localStorage.getItem("acc_theme")||"system"},applyTheme(t){const d=t==="dark"||(t==="system"&&this.detectSystemTheme()==="dark");document.body.classList.toggle("dark-theme",d);localStorage.setItem("acc_theme",t);state.theme=t},init(){this.applyTheme(this.getTheme());window.matchMedia?.("(prefers-color-scheme: dark)").addEventListener("change",()=>{if(this.getTheme()==="system")this.applyTheme("system")})},resetToSystem(){localStorage.removeItem("acc_theme");this.applyTheme("system")}};function ensureElements(){if(elements.panel&&document.body.contains(elements.panel))return true;elements={body:document.body,panel:document.getElementById("accessibility-panel"),sideWidgets:document.getElementById("side-widgets"),closeBtn:document.getElementById("close-panel-btn"),openBtn:document.getElementById("accessibility-btn"),shortcutsModal:document.getElementById("keyboard-shortcuts-modal"),magnifierTooltip:document.getElementById("magnifier-tooltip"),readingGuide:document.getElementById("reading-guide")};return!!elements.panel}function isPanelClosed(){return!ensureElements()||elements.panel.classList.contains("accessibility-panel-hidden")}function saveState(){localStorage.setItem("accessControlState",JSON.stringify(state))}function loadSavedState(){try{const s=JSON.parse(localStorage.getItem("accessControlState")||"{}");Object.assign(state,s)}catch(e){localStorage.removeItem("accessControlState")}}function updateDots(el,l=1){el?.querySelectorAll(".dot").forEach((d,i)=>d.classList.toggle("active",i<l))}function resetDots(el){el?.querySelectorAll(".dot").forEach(d=>d.classList.remove("active"))}function updateAriaPressed(el,a){el?.setAttribute("aria-pressed",a?"true":"false")}function openPanel(){if(!ensureElements())return;elements.panel.classList.remove("accessibility-panel-hidden");elements.sideWidgets?.classList.add("side-widgets-hidden");setTimeout(()=>elements.closeBtn?.focus(),100)}function closePanel(){if(!ensureElements()||isPanelClosed())return;elements.panel.classList.add("accessibility-panel-hidden");elements.sideWidgets?.classList.remove("side-widgets-hidden");elements.openBtn?.focus()}function togglePanel(){isPanelClosed()?openPanel():closePanel()}function toggleMaximize(){ensureElements();elements.panel?.classList.toggle("panel-expanded")}function showKeyboardShortcuts(){const m=document.getElementById("keyboard-shortcuts-modal");if(m){m.hidden=false;renderShortcuts("chrome");setupBrowserTabs();m.querySelector("button")?.focus()}}function closeShortcutsModal(){const m=document.getElementById("keyboard-shortcuts-modal");if(m)m.hidden=true}function renderShortcuts(b){const l=document.getElementById("shortcuts-list");if(!l)return;const s=shortcutsByBrowser[b]||shortcutsByBrowser.chrome;l.innerHTML=s.map(x=>`<div class="shortcut-item">${x.keys.map(k=>`<kbd>${k}</kbd>`).join("+")}<span>${x.desc}</span></div>`).join("")}function setupBrowserTabs(){document.querySelectorAll(".browser-tab").forEach(t=>{t.addEventListener("click",()=>{document.querySelectorAll(".browser-tab").forEach(x=>x.classList.remove("active"));t.classList.add("active");renderShortcuts(t.dataset.browser)})})}function toggleSimple(c,el){if(!ensureElements())return;const a=elements.body.classList.toggle(c);el?.classList.toggle("active",a);updateAriaPressed(el,a);updateDots(el,a?1:0);if(c==="stop-sounds")toggleStopSounds(a);if(c==="magnifier")toggleMagnifier(a);saveState()}function cycleFeature(f,v,el){if(!ensureElements())return;state[f]=((state[f]||0)+1)%(v.length+1);const i=state[f]-1;const val=v[i];const b=el?.querySelector(".level-badge");cleanupFeatureClasses(f);if(i===-1){el?.classList.remove("active");updateAriaPressed(el,false);if(b)b.style.display="none";resetDots(el);resetFeatureCSS(f)}else{el?.classList.add("active");updateAriaPressed(el,true);updateDots(el,state[f]);if(b){b.textContent=displayNames[f]?.[val]||val;b.style.display="block"}applyFeature(f,val);const n={fontSize:"Tamanho de fonte",fontStyle:"Estilo de fonte",letterSpacing:"Espaçamento entre letras",lineHeight:"Altura de linha",contrast:"Contraste",colorblind:"Modo daltônico",saturation:"Saturação",bigCursor:"Cursor grande"};announceToSR(`${n[f]||f}: ${displayNames[f]?.[val]||val}`)}saveState()}function cleanupFeatureClasses(f){const m={fontStyle:["font-atkinson","font-newsreader","font-opendyslexic"],contrast:["inverted","dark-contrast","light-contrast"],colorblind:["protanopia","deuteranopia","tritanopia"],saturation:["saturation-low","saturation-high","monochrome"],readingGuide:["reading-guide-azul","reading-guide-laranja","reading-guide-preto"],bigCursor:["big-cursor-medium","big-cursor-large","big-cursor-xlarge"]};m[f]?.forEach(c=>elements.body.classList.remove(c))}function resetFeatureCSS(f){const r={fontSize:()=>{document.documentElement.style.setProperty("--font-scale","1");document.body.removeAttribute("data-font-scale");document.getElementById("accessibility-panel")?.classList.remove("font-large")},letterSpacing:()=>document.documentElement.style.setProperty("--letter-spacing","0"),lineHeight:()=>document.documentElement.style.setProperty("--line-height","1.6"),readingMask:()=>toggleReadingMask(false),readingGuide:()=>toggleReadingGuide(false),bigCursor:()=>cleanupFeatureClasses("bigCursor")};r[f]?.()}function applyFeature(f,v){const a={fontSize:()=>{document.documentElement.style.setProperty("--font-scale",v);document.body.setAttribute("data-font-scale",v);const p=document.getElementById("accessibility-panel");if(p)p.classList.toggle("font-large",v==="2.0")},letterSpacing:()=>{const s=(parseFloat(v)-1)*0.1;document.documentElement.style.setProperty("--letter-spacing",s+"em")},lineHeight:()=>{const h=1.6*parseFloat(v);document.documentElement.style.setProperty("--line-height",h)},fontStyle:()=>elements.body.classList.add("font-"+v),contrast:()=>elements.body.classList.add(v),colorblind:()=>elements.body.classList.add(v),saturation:()=>elements.body.classList.add(v==="monochrome"?"monochrome":`saturation-${v}`),readingMask:()=>toggleReadingMask(true,v),readingGuide:()=>toggleReadingGuide(true,v),bigCursor:()=>elements.body.classList.add("big-cursor-"+v)};a[f]?.()}function toggleReadingMask(a,s){const t=document.getElementById("reading-mask-top");const b=document.getElementById("reading-mask-bottom");if(!t||!b)return;t.style.display=a?"block":"none";b.style.display=a?"block":"none";if(mouseMoveHandler){window.removeEventListener("mousemove",mouseMoveHandler);mouseMoveHandler=null}if(a){const h=s==="sm"?60:s==="md"?120:200;mouseMoveHandler=debounce(e=>{t.style.height=Math.max(0,e.clientY-h/2)+"px";b.style.top=(e.clientY+h/2)+"px"});window.addEventListener("mousemove",mouseMoveHandler);announceToSR(`Máscara de leitura ativada: ${s==="sm"?"pequena":s==="md"?"média":"grande"}`)}}function toggleReadingGuide(a,c){const g=document.getElementById("reading-guide");if(!g)return;g.style.display=a?"block":"none";g.classList.remove("guide-azul","guide-laranja","guide-preto");elements.body.classList.remove("reading-guide-azul","reading-guide-laranja","reading-guide-preto");if(a&&c){g.classList.add("guide-"+c);elements.body.classList.add("reading-guide-"+c)}if(readingGuideHandler){window.removeEventListener("mousemove",readingGuideHandler);readingGuideHandler=null}if(a){readingGuideHandler=debounce(e=>{g.style.top=e.clientY+"px"});window.addEventListener("mousemove",readingGuideHandler);announceToSR(`Guia de leitura ativado: cor ${c}`)}}let magnifierMoveHandler=null;function toggleMagnifier(a){state.magnifierActive=a;elements.body.classList.toggle("magnifier-active",a);const tt=document.getElementById("magnifier-tooltip");if(!tt)return;if(magnifierHandler){document.removeEventListener("mouseover",magnifierHandler);magnifierHandler=null}if(magnifierMoveHandler){document.removeEventListener("mousemove",magnifierMoveHandler);magnifierMoveHandler=null}if(a){magnifierHandler=e=>{const t=e.target;if(t.closest("#accessibility-panel,#accessibility-module,.side-widgets-container,#glossary-modal,.shortcuts-modal")){tt.style.display="none";return}const sel="p,span,h1,h2,h3,h4,h5,h6,li,td,th,a,label,strong,em,b,i,blockquote,figcaption,caption,dt,dd,abbr,cite,q,mark,small,sub,sup,time,code,pre,article,section,div";let txt="";if(t.matches(sel)){txt=t.textContent?.trim()}else{const x=t.closest(sel);if(x)txt=x.textContent?.trim()}if(txt&&txt.length>0){if(txt.length>300)txt=txt.substring(0,300)+"...";tt.textContent=txt;tt.style.display="block"}else{tt.style.display="none"}};magnifierMoveHandler=debounce(e=>{if(tt.style.display==="block"){const x=Math.min(e.clientX+20,window.innerWidth-tt.offsetWidth-20);const y=Math.min(e.clientY+25,window.innerHeight-tt.offsetHeight-10);tt.style.left=x+"px";tt.style.top=y+"px"}});announceToSR("Lupa de conteúdo ativada");document.addEventListener("mouseover",magnifierHandler);document.addEventListener("mousemove",magnifierMoveHandler)}else{tt.style.display="none"}}function toggleTTSClick(el){if(!ensureElements())return;state.ttsSpeed=((state.ttsSpeed||0)+1)%4;const sm={1:"normal",2:"slow",3:"fast"};const rm={1:1,2:0.7,3:1.5};const b=el?.querySelector(".level-badge");if(state.ttsSpeed===0){state.ttsActive=false;el?.classList.remove("active");updateAriaPressed(el,false);if(b)b.style.display="none";resetDots(el);elements.body.style.cursor="";if(ttsClickHandler){document.removeEventListener("click",ttsClickHandler,true);ttsClickHandler=null}window.speechSynthesis.cancel()}else{state.ttsActive=true;state.ttsRate=rm[state.ttsSpeed];el?.classList.add("active");updateAriaPressed(el,true);updateDots(el,state.ttsSpeed);if(b){b.textContent=displayNames.tts[sm[state.ttsSpeed]];b.style.display="block"}elements.body.style.cursor="url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24'%3E%3Cpath fill='%231A3E74' d='M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z'/%3E%3C/svg%3E\") 16 16, pointer";if(ttsClickHandler){document.removeEventListener("click",ttsClickHandler,true)}ttsClickHandler=e=>{if(e.target.closest("#accessibility-panel,#accessibility-module,.side-widgets-container,.shortcuts-modal,#glossary-modal"))return;const t=e.target;const x=t.closest("p,span,h1,h2,h3,h4,h5,h6,li,td,th,a,label,article,section,div");if(x){e.preventDefault();e.stopPropagation();const r=document.caretRangeFromPoint(e.clientX,e.clientY);let txt="";if(r){const f=x.textContent||"";const o=r.startOffset;const n=r.startContainer.textContent||"";const c=f.indexOf(n)+o;txt=f.substring(c).trim()}if(!txt||txt.length<3){txt=x.textContent?.trim()||""}if(txt.length>0){window.speechSynthesis.cancel();const u=new SpeechSynthesisUtterance(txt);u.lang="pt-BR";u.rate=state.ttsRate||1;window.speechSynthesis.speak(u)}}};document.addEventListener("click",ttsClickHandler,true)}saveState()}function toggleStopSounds(a){state.stopSounds=a;document.querySelectorAll("audio,video").forEach(m=>{m.muted=a;if(a)m.pause()});document.querySelectorAll("iframe").forEach(f=>{try{const s=f.src;if(a){if(s.includes("youtube")&&!s.includes("mute=1")){f.src=s+(s.includes("?")?"&":"?")+"mute=1"}f.setAttribute("data-original-src",s)}}catch(e){}})}function toggleLibrasWidget(){document.querySelector("[vw-access-button]")?.click()}let currentGlossaryLetter="A";let alphabetExpanded=true;async function loadGlossary(){try{const r=await fetch("glossario.json");glossaryData=(await r.json()).termos||[]}catch(e){glossaryData=[]}}function openGlossary(st=null){let m=document.getElementById("glossary-modal");if(!m){m=document.createElement("div");m.id="glossary-modal";m.className="shortcuts-modal";m.setAttribute("role","dialog");m.setAttribute("aria-modal","true");const al="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");m.innerHTML=`<div class="glossary-content"><header class="shortcuts-header"><h2><i class="fas fa-book-medical"></i> Glossário de Enfermagem</h2><button type="button" class="icon-btn" data-action="closeGlossary" aria-label="Fechar"><i class="fas fa-times"></i></button></header><div class="glossary-body"><nav class="glossary-alphabet" id="glossary-alphabet"><button type="button" class="alphabet-toggle" id="alphabet-toggle" title="Expandir/Retrair"><i class="fas fa-chevron-left"></i></button><div class="alphabet-letters" id="alphabet-letters">${al.map(l=>`<button type="button" class="alphabet-letter${l==="A"?" active":""}" data-letter="${l}">${l}</button>`).join("")}</div></nav><div class="glossary-main"><div class="glossary-search"><input type="text" id="glossary-search-input" placeholder="Buscar termo..." autocomplete="off"></div><ul class="glossary-list" id="glossary-list"></ul></div></div></div>`;document.body.appendChild(m);m.querySelector("#alphabet-toggle").addEventListener("click",()=>{alphabetExpanded=!alphabetExpanded;m.querySelector(".glossary-alphabet").classList.toggle("collapsed",!alphabetExpanded);m.querySelector("#alphabet-toggle i").className=alphabetExpanded?"fas fa-chevron-left":"fas fa-chevron-right"});m.querySelectorAll(".alphabet-letter").forEach(b=>{b.addEventListener("click",()=>{m.querySelectorAll(".alphabet-letter").forEach(x=>x.classList.remove("active"));b.classList.add("active");currentGlossaryLetter=b.dataset.letter;m.querySelector("#glossary-search-input").value="";renderGlossaryList()})});m.querySelector("#glossary-search-input").addEventListener("input",e=>{const v=e.target.value;if(v){m.querySelectorAll(".alphabet-letter").forEach(x=>x.classList.remove("active"));renderGlossaryList(v)}else{m.querySelector(`.alphabet-letter[data-letter="${currentGlossaryLetter}"]`)?.classList.add("active");renderGlossaryList()}});m.addEventListener("click",e=>{if(e.target===m)closeGlossary()})}m.hidden=false;if(st){const i=m.querySelector("#glossary-search-input");i.value=st;m.querySelectorAll(".alphabet-letter").forEach(x=>x.classList.remove("active"));renderGlossaryList(st)}else{renderGlossaryList()}setTimeout(()=>m.querySelector("#glossary-search-input")?.focus(),100)}function renderGlossaryList(f=""){const l=document.getElementById("glossary-list");if(!l)return;let fl;if(f){fl=glossaryData.filter(x=>x.termo.toLowerCase().includes(f.toLowerCase())||x.definicao.toLowerCase().includes(f.toLowerCase()))}else{fl=glossaryData.filter(x=>x.termo.charAt(0).toUpperCase()===currentGlossaryLetter)}if(fl.length===0){l.innerHTML=`<li class="glossary-empty"><i class="fas fa-info-circle"></i> Nenhum termo com "${f||currentGlossaryLetter}"</li>`;return}l.innerHTML=fl.map(x=>`<li class="glossary-item"><div class="glossary-term">${sanitizeHTML(x.termo)}</div><div class="glossary-definition">${sanitizeHTML(x.definicao)}</div></li>`).join("")}function closeGlossary(){const m=document.getElementById("glossary-modal");if(m)m.hidden=true}function setupTermLinks(){document.addEventListener("click",e=>{const t=e.target.closest("[data-definition],abbr[title]");if(t&&!t.closest("#accessibility-panel,#glossary-modal")){e.preventDefault();const s=t.textContent?.trim()||t.getAttribute("title")||"";if(s)openGlossary(s)}})}function resetAll(){ensureElements();Object.keys(state).forEach(k=>{if(!k.startsWith("_"))state[k]=typeof state[k]==="boolean"?false:0});state.ttsRate=1;document.documentElement.style.setProperty("--font-scale","1");document.documentElement.style.setProperty("--letter-spacing","0");document.documentElement.style.setProperty("--line-height","1.6");document.documentElement.style.setProperty("--cursor-scale","1");document.body.removeAttribute("data-font-scale");document.getElementById("accessibility-panel")?.classList.remove("font-large");allClasses.forEach(c=>elements.body?.classList.remove(c));elements.body.style.cursor="";if(mouseMoveHandler){window.removeEventListener("mousemove",mouseMoveHandler);mouseMoveHandler=null}if(readingGuideHandler){window.removeEventListener("mousemove",readingGuideHandler);readingGuideHandler=null}if(magnifierHandler){document.removeEventListener("mouseover",magnifierHandler);magnifierHandler=null}if(ttsClickHandler){document.removeEventListener("click",ttsClickHandler);ttsClickHandler=null}toggleReadingMask(false);toggleReadingGuide(false);toggleMagnifier(false);toggleStopSounds(false);window.speechSynthesis.cancel();ThemeManager.resetToSystem();document.querySelectorAll(".accessibility-card").forEach(c=>{c.classList.remove("active");updateAriaPressed(c,false);resetDots(c);const b=c.querySelector(".level-badge");if(b)b.style.display="none"});["reading-mask-top","reading-mask-bottom","reading-guide","magnifier-tooltip"].forEach(id=>{const el=document.getElementById(id);if(el)el.style.display="none"});localStorage.removeItem("accessControlState");window.dispatchEvent(new CustomEvent("Accessibility:Reset"));announceToSR("Todas as configurações de acessibilidade foram restauradas");const btn=document.querySelector('[data-action="resetAll"]');if(btn){const o=btn.innerHTML;btn.innerHTML='<i class="fas fa-check" style="color:#10b981"></i> Restaurado!';setTimeout(()=>btn.innerHTML=o,1500)}}function handleCardClick(c){const t=c.dataset.type;const f=c.dataset.feature;if(f==="glossary"){openGlossary();return}if(t==="simple")toggleSimple(f,c);else if(t==="cycle")cycleFeature(f,c.dataset.values.split(","),c);else if(t==="tts-click")toggleTTSClick(c)}function handleAction(a){const ac={togglePanel,toggleMaximize,toggleLibras:toggleLibrasWidget,resetAll,showKeyboardShortcuts,closeShortcutsModal,openGlossary,closeGlossary};ac[a]?.()}function setupEvents(){document.addEventListener("click",e=>{const a=e.target.closest("[data-action]");if(a)return handleAction(a.dataset.action);const c=e.target.closest(".accessibility-card");if(c)return handleCardClick(c);if(!isPanelClosed()){const ip=elements.panel?.contains(e.target);const iw=elements.sideWidgets?.contains(e.target);const im=elements.shortcutsModal?.contains(e.target);if(!ip&&!iw&&!im)closePanel()}});document.addEventListener("keydown",e=>{if(e.key==="Escape"){closeShortcutsModal();closePanel();return}if((e.key==="Enter"||e.key===" ")&&e.target.closest(".accessibility-card")){e.preventDefault();handleCardClick(e.target.closest(".accessibility-card"));return}if(e.altKey){const s={a:togglePanel,"1":()=>document.querySelector('[data-feature="fontSize"]')?.click(),c:()=>document.querySelector('[data-feature="contrast"]')?.click(),l:()=>document.querySelector('[data-feature="highlight-links"]')?.click(),h:()=>document.querySelector('[data-feature="highlight-headers"]')?.click(),m:()=>document.querySelector('[data-feature="readingMask"]')?.click(),g:()=>document.querySelector('[data-feature="reading-guide"]')?.click(),r:()=>document.querySelector('[data-feature="reading-mode"]')?.click(),t:()=>document.querySelector('[data-feature="tts"]')?.click(),i:()=>document.querySelector('[data-feature="hide-images"]')?.click(),"0":resetAll};if(s[e.key]){e.preventDefault();s[e.key]()}}})}function setupDrag(){const p=document.getElementById("accessibility-panel");const h=document.getElementById("panel-drag-handle");if(!p||!h)return;let d=false;let ox=0,oy=0;h.addEventListener("mousedown",e=>{if(e.target.closest("button"))return;d=true;ox=e.clientX-p.offsetLeft;oy=e.clientY-p.offsetTop;h.style.cursor="grabbing";e.preventDefault()});document.addEventListener("mousemove",e=>{if(!d)return;const x=Math.max(0,Math.min(window.innerWidth-p.offsetWidth,e.clientX-ox));const y=Math.max(0,Math.min(window.innerHeight-p.offsetHeight,e.clientY-oy));p.style.left=x+"px";p.style.top=y+"px";p.style.right="auto"});document.addEventListener("mouseup",()=>{d=false;h.style.cursor="grab"})}function init(){if(state._initialized)return;ThemeManager.init();if(ensureElements()){setupEvents();setupDrag();loadSavedState();loadGlossary();setupTermLinks();const vl=setInterval(()=>{if(window.VLibras?.Widget){clearInterval(vl);if(!document.querySelector("[vw]")){new window.VLibras.Widget("https://vlibras.gov.br/app")}}},200);setTimeout(()=>clearInterval(vl),10000)}state._initialized=true}return{init,togglePanel,toggleMaximize,resetAll,ThemeManager,state}})();function tryInit(){const p=document.getElementById("accessibility-panel");if(p){window.AccessControl.init()}else{setTimeout(tryInit,100)}}if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",tryInit)}else{tryInit()}