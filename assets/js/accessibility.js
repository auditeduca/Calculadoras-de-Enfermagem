window.AccessControl=window.AccessControl||(function(){"use strict";const state={fontSize:0,fontStyle:0,letterSpacing:0,lineHeight:0,readingMask:0,readingGuide:0,contrast:0,colorblind:0,saturation:0,bigCursor:0,ttsSpeed:0,ttsActive:false,stopSounds:false,magnifierActive:false,theme:"system",_initialized:false};let elements={};let mouseMoveHandler=null;let readingGuideHandler=null;let magnifierHandler=null;let ttsClickHandler=null;let glossaryData=[];function debounce(fn,delay=16){let timeout;return function(...args){cancelAnimationFrame(timeout);timeout=requestAnimationFrame(()=>fn.apply(this,args))}}function sanitizeHTML(str){const div=document.createElement('div');div.textContent=str;return div.innerHTML}function announceToSR(message){let announcer=document.getElementById('sr-announcer');if(!announcer){announcer=document.createElement('div');announcer.id='sr-announcer';announcer.setAttribute('role','status');announcer.setAttribute('aria-live','polite');announcer.setAttribute('aria-atomic','true');announcer.className='sr-only';document.body.appendChild(announcer)}announcer.textContent='';setTimeout(()=>{announcer.textContent=message},100)}const displayNames={fontSize:{"1.2":"120%","1.5":"150%","2.0":"200%"},fontStyle:{atkinson:"Atkinson",newsreader:"Newsreader",opendyslexic:"OpenDyslexic"},lineHeight:{"1.2":"120%","1.5":"150%","2.0":"200%"},letterSpacing:{"1.2":"120%","1.5":"150%","2.0":"200%"},contrast:{inverted:"Invertido","dark-contrast":"Escuro","light-contrast":"Claro"},colorblind:{deuteranopia:"Verde",protanopia:"Vermelho",tritanopia:"Azul"},saturation:{low:"Baixa",high:"Alta",monochrome:"Mono"},readingMask:{sm:"Pequeno",md:"Medio",lg:"Grande"},readingGuide:{azul:"Azul",laranja:"Laranja",preto:"Preto"},bigCursor:{medium:"120%",large:"150%",xlarge:"200%"},tts:{normal:"Normal",slow:"Lento",fast:"Rapido"}};const allClasses=["inverted","dark-contrast","light-contrast","protanopia","deuteranopia","tritanopia","saturation-low","saturation-high","monochrome","highlight-links","highlight-headers","bold-text","stop-anim","stop-sounds","hide-images","font-atkinson","font-newsreader","font-opendyslexic","reading-mode","glossary","magnifier-active","reading-guide-azul","reading-guide-laranja","reading-guide-preto","big-cursor-medium","big-cursor-large","big-cursor-xlarge"];const shortcutsByBrowser={chrome:[{keys:["Alt","A"],desc:"Abrir/Fechar menu acessibilidade"},{keys:["Alt","1"],desc:"Aumentar fonte"},{keys:["Alt","2"],desc:"Diminuir fonte"},{keys:["Alt","C"],desc:"Alto contraste"},{keys:["Alt","L"],desc:"Destacar links"},{keys:["Alt","H"],desc:"Destacar cabecalhos"},{keys:["Alt","M"],desc:"Mascara de leitura"},{keys:["Alt","G"],desc:"Guia de leitura"},{keys:["Alt","R"],desc:"Modo leitura"},{keys:["Alt","T"],desc:"Leitor TTS"},{keys:["Alt","I"],desc:"Esconder imagens"},{keys:["Alt","0"],desc:"Restaurar tudo"},{keys:["Esc"],desc:"Fechar paineis"}],firefox:[{keys:["Alt","Shift","A"],desc:"Abrir/Fechar menu acessibilidade"},{keys:["Alt","Shift","1"],desc:"Aumentar fonte"},{keys:["Alt","Shift","2"],desc:"Diminuir fonte"},{keys:["Alt","Shift","C"],desc:"Alto contraste"},{keys:["Alt","Shift","L"],desc:"Destacar links"},{keys:["Alt","Shift","H"],desc:"Destacar cabecalhos"},{keys:["Alt","Shift","M"],desc:"Mascara de leitura"},{keys:["Alt","Shift","G"],desc:"Guia de leitura"},{keys:["Alt","Shift","R"],desc:"Modo leitura"},{keys:["Alt","Shift","T"],desc:"Leitor TTS"},{keys:["Alt","Shift","I"],desc:"Esconder imagens"},{keys:["Alt","Shift","0"],desc:"Restaurar tudo"},{keys:["Esc"],desc:"Fechar paineis"}],safari:[{keys:["Ctrl","Option","A"],desc:"Abrir/Fechar menu acessibilidade"},{keys:["Ctrl","Option","1"],desc:"Aumentar fonte"},{keys:["Ctrl","Option","2"],desc:"Diminuir fonte"},{keys:["Ctrl","Option","C"],desc:"Alto contraste"},{keys:["Ctrl","Option","L"],desc:"Destacar links"},{keys:["Ctrl","Option","H"],desc:"Destacar cabecalhos"},{keys:["Ctrl","Option","M"],desc:"Mascara de leitura"},{keys:["Ctrl","Option","G"],desc:"Guia de leitura"},{keys:["Ctrl","Option","R"],desc:"Modo leitura"},{keys:["Ctrl","Option","T"],desc:"Leitor TTS"},{keys:["Ctrl","Option","I"],desc:"Esconder imagens"},{keys:["Ctrl","Option","0"],desc:"Restaurar tudo"},{keys:["Esc"],desc:"Fechar paineis"}]};const ThemeManager={detectSystemTheme(){return window.matchMedia?.("(prefers-color-scheme: dark)").matches?"dark":"light"},getTheme(){return localStorage.getItem("acc_theme")||"system"},applyTheme(theme){const isDark=theme==="dark"||(theme==="system"&&this.detectSystemTheme()==="dark");document.body.classList.toggle("dark-theme",isDark);localStorage.setItem("acc_theme",theme);state.theme=theme},init(){this.applyTheme(this.getTheme());window.matchMedia?.("(prefers-color-scheme: dark)").addEventListener("change",()=>{if(this.getTheme()==="system")this.applyTheme("system")})},resetToSystem(){localStorage.removeItem("acc_theme");this.applyTheme("system")}};function ensureElements(){if(elements.panel&&document.body.contains(elements.panel))return true;elements={body:document.body,panel:document.getElementById("accessibility-panel"),sideWidgets:document.getElementById("side-widgets"),closeBtn:document.getElementById("close-panel-btn"),openBtn:document.getElementById("accessibility-btn"),shortcutsModal:document.getElementById("keyboard-shortcuts-modal"),magnifierTooltip:document.getElementById("magnifier-tooltip"),readingGuide:document.getElementById("reading-guide")};return!!elements.panel}function isPanelClosed(){return!ensureElements()||elements.panel.classList.contains("accessibility-panel-hidden")}function saveState(){localStorage.setItem("accessControlState",JSON.stringify(state))}function loadSavedState(){try{const saved=JSON.parse(localStorage.getItem("accessControlState")||"{}");Object.assign(state,saved)}catch(e){localStorage.removeItem("accessControlState")}}function updateDots(element,level=1){element?.querySelectorAll(".dot").forEach((dot,i)=>dot.classList.toggle("active",i<level))}function resetDots(element){element?.querySelectorAll(".dot").forEach(dot=>dot.classList.remove("active"))}function updateAriaPressed(element,isActive){element?.setAttribute("aria-pressed",isActive?"true":"false")}function openPanel(){if(!ensureElements())return;elements.panel.classList.remove("accessibility-panel-hidden");elements.sideWidgets?.classList.add("side-widgets-hidden");setTimeout(()=>elements.closeBtn?.focus(),100)}function closePanel(){if(!ensureElements()||isPanelClosed())return;elements.panel.classList.add("accessibility-panel-hidden");elements.sideWidgets?.classList.remove("side-widgets-hidden");elements.openBtn?.focus()}function togglePanel(){isPanelClosed()?openPanel():closePanel()}function toggleMaximize(){ensureElements();elements.panel?.classList.toggle("panel-expanded")}function showKeyboardShortcuts(){const modal=document.getElementById("keyboard-shortcuts-modal");if(modal){modal.hidden=false;renderShortcuts("chrome");setupBrowserTabs();modal.querySelector("button")?.focus()}}function closeShortcutsModal(){const modal=document.getElementById("keyboard-shortcuts-modal");if(modal)modal.hidden=true}function renderShortcuts(browser){const list=document.getElementById("shortcuts-list");if(!list)return;const shortcuts=shortcutsByBrowser[browser]||shortcutsByBrowser.chrome;list.innerHTML=shortcuts.map(s=>`<div class="shortcut-item">${s.keys.map(k=>`<kbd>${k}</kbd>`).join("+")}<span>${s.desc}</span></div>`).join("")}function setupBrowserTabs(){document.querySelectorAll(".browser-tab").forEach(tab=>{tab.addEventListener("click",()=>{document.querySelectorAll(".browser-tab").forEach(t=>t.classList.remove("active"));tab.classList.add("active");renderShortcuts(tab.dataset.browser)})})}function toggleSimple(className,element){if(!ensureElements())return;const isActive=elements.body.classList.toggle(className);element?.classList.toggle("active",isActive);updateAriaPressed(element,isActive);updateDots(element,isActive?1:0);if(className==="stop-sounds")toggleStopSounds(isActive);if(className==="magnifier")toggleMagnifier(isActive);saveState()}function cycleFeature(feature,values,element){if(!ensureElements())return;state[feature]=((state[feature]||0)+1)%(values.length+1);const index=state[feature]-1;const value=values[index];const badge=element?.querySelector(".level-badge");cleanupFeatureClasses(feature);if(index===-1){element?.classList.remove("active");updateAriaPressed(element,false);if(badge)badge.style.display="none";resetDots(element);resetFeatureCSS(feature)}else{element?.classList.add("active");updateAriaPressed(element,true);updateDots(element,state[feature]);if(badge){badge.textContent=displayNames[feature]?.[value]||value;badge.style.display="block"}applyFeature(feature,value);const featureNames={fontSize:'Tamanho de fonte',fontStyle:'Estilo de fonte',letterSpacing:'Espacamento entre letras',lineHeight:'Altura de linha',contrast:'Contraste',colorblind:'Modo daltonico',saturation:'Saturacao',bigCursor:'Cursor grande'};const name=featureNames[feature]||feature;const displayValue=displayNames[feature]?.[value]||value;announceToSR(`${name}: ${displayValue}`)}saveState()}function cleanupFeatureClasses(feature){const classMap={fontStyle:["font-atkinson","font-newsreader","font-opendyslexic"],contrast:["inverted","dark-contrast","light-contrast"],colorblind:["protanopia","deuteranopia","tritanopia"],saturation:["saturation-low","saturation-high","monochrome"],readingGuide:["reading-guide-azul","reading-guide-laranja","reading-guide-preto"],bigCursor:["big-cursor-medium","big-cursor-large","big-cursor-xlarge"]};classMap[feature]?.forEach(cls=>elements.body.classList.remove(cls))}function resetFeatureCSS(feature){const resets={fontSize:()=>{document.documentElement.style.setProperty("--font-scale","1");document.body.removeAttribute("data-font-scale");document.getElementById("accessibility-panel")?.classList.remove("font-large")},letterSpacing:()=>document.documentElement.style.setProperty("--letter-spacing","0"),lineHeight:()=>document.documentElement.style.setProperty("--line-height","1.6"),readingMask:()=>toggleReadingMask(false),readingGuide:()=>toggleReadingGuide(false),bigCursor:()=>cleanupFeatureClasses("bigCursor")};resets[feature]?.()}function applyFeature(feature,value){const actions={fontSize:()=>{document.documentElement.style.setProperty("--font-scale",value);document.body.setAttribute("data-font-scale",value);const panel=document.getElementById("accessibility-panel");if(panel)panel.classList.toggle("font-large",value==="2.0")},letterSpacing:()=>{const spacing=(parseFloat(value)-1)*0.1;document.documentElement.style.setProperty("--letter-spacing",spacing+"em")},lineHeight:()=>{const height=1.6*parseFloat(value);document.documentElement.style.setProperty("--line-height",height)},fontStyle:()=>elements.body.classList.add("font-"+value),contrast:()=>elements.body.classList.add(value),colorblind:()=>elements.body.classList.add(value),saturation:()=>elements.body.classList.add(value==="monochrome"?"monochrome":`saturation-${value}`),readingMask:()=>toggleReadingMask(true,value),readingGuide:()=>toggleReadingGuide(true,value),bigCursor:()=>elements.body.classList.add("big-cursor-"+value)};actions[feature]?.()}function toggleReadingMask(active,size){const maskTop=document.getElementById("reading-mask-top");const maskBottom=document.getElementById("reading-mask-bottom");if(!maskTop||!maskBottom)return;maskTop.style.display=active?"block":"none";maskBottom.style.display=active?"block":"none";if(mouseMoveHandler){window.removeEventListener("mousemove",mouseMoveHandler);mouseMoveHandler=null}if(active){const height=size==="sm"?60:size==="md"?120:200;mouseMoveHandler=debounce((e)=>{maskTop.style.height=Math.max(0,e.clientY-height/2)+"px";maskBottom.style.top=(e.clientY+height/2)+"px"});window.addEventListener("mousemove",mouseMoveHandler);announceToSR(`Mascara de leitura ativada: ${size==='sm'?'pequena':size==='md'?'media':'grande'}`)}}function toggleReadingGuide(active,color){const guide=document.getElementById("reading-guide");if(!guide)return;guide.style.display=active?"block":"none";guide.classList.remove("guide-azul","guide-laranja","guide-preto");elements.body.classList.remove("reading-guide-azul","reading-guide-laranja","reading-guide-preto");if(active&&color){guide.classList.add("guide-"+color);elements.body.classList.add("reading-guide-"+color)}if(readingGuideHandler){window.removeEventListener("mousemove",readingGuideHandler);readingGuideHandler=null}if(active){readingGuideHandler=debounce((e)=>{guide.style.top=e.clientY+"px"});window.addEventListener("mousemove",readingGuideHandler);announceToSR(`Guia de leitura ativado: cor ${color}`)}}let magnifierMoveHandler=null;function toggleMagnifier(active){state.magnifierActive=active;elements.body.classList.toggle("magnifier-active",active);const tooltip=document.getElementById("magnifier-tooltip");if(!tooltip)return;if(magnifierHandler){document.removeEventListener("mouseover",magnifierHandler);magnifierHandler=null}if(magnifierMoveHandler){document.removeEventListener("mousemove",magnifierMoveHandler);magnifierMoveHandler=null}if(active){magnifierHandler=(e)=>{const target=e.target;if(target.closest("#accessibility-panel, #accessibility-module, .side-widgets-container, #glossary-modal, .shortcuts-modal")){tooltip.style.display="none";return}let textElement=target;let text="";const textSelectors="p, span, h1, h2, h3, h4, h5, h6, li, td, th, a, label, strong, em, b, i, blockquote, figcaption, caption, dt, dd, abbr, cite, q, mark, small, sub, sup, time, code, pre, article, section, div";if(target.matches(textSelectors)){text=target.textContent?.trim()}else{textElement=target.closest(textSelectors);if(textElement){text=textElement.textContent?.trim()}}if(text&&text.length>0){if(text.length>300)text=text.substring(0,300)+"...";tooltip.textContent=text;tooltip.style.display="block"}else{tooltip.style.display="none"}};magnifierMoveHandler=debounce((e)=>{if(tooltip.style.display==="block"){const x=Math.min(e.clientX+20,window.innerWidth-tooltip.offsetWidth-20);const y=Math.min(e.clientY+25,window.innerHeight-tooltip.offsetHeight-10);tooltip.style.left=x+"px";tooltip.style.top=y+"px"}});announceToSR('Lupa de conteudo ativada');document.addEventListener("mouseover",magnifierHandler);document.addEventListener("mousemove",magnifierMoveHandler)}else{tooltip.style.display="none"}}function toggleTTSClick(element){if(!ensureElements())return;state.ttsSpeed=((state.ttsSpeed||0)+1)%4;const speedMap={1:"normal",2:"slow",3:"fast"};const rateMap={1:1,2:0.7,3:1.5};const badge=element?.querySelector(".level-badge");if(state.ttsSpeed===0){state.ttsActive=false;element?.classList.remove("active");updateAriaPressed(element,false);if(badge)badge.style.display="none";resetDots(element);elements.body.style.cursor="";if(ttsClickHandler){document.removeEventListener("click",ttsClickHandler,true);ttsClickHandler=null}window.speechSynthesis.cancel()}else{state.ttsActive=true;state.ttsRate=rateMap[state.ttsSpeed];element?.classList.add("active");updateAriaPressed(element,true);updateDots(element,state.ttsSpeed);if(badge){badge.textContent=displayNames.tts[speedMap[state.ttsSpeed]];badge.style.display="block"}elements.body.style.cursor="url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24'%3E%3Cpath fill='%231A3E74' d='M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z'/%3E%3C/svg%3E\") 16 16, pointer";if(ttsClickHandler){document.removeEventListener("click",ttsClickHandler,true)}ttsClickHandler=(e)=>{if(e.target.closest("#accessibility-panel, #accessibility-module, .side-widgets-container, .shortcuts-modal, #glossary-modal"))return;const target=e.target;const textElement=target.closest("p, span, h1, h2, h3, h4, h5, h6, li, td, th, a, label, article, section, div");if(textElement){e.preventDefault();e.stopPropagation();const selection=window.getSelection();const range=document.caretRangeFromPoint(e.clientX,e.clientY);let textToRead="";if(range){const fullText=textElement.textContent||"";const offset=range.startOffset;const nodeText=range.startContainer.textContent||"";const clickedIndex=fullText.indexOf(nodeText)+offset;textToRead=fullText.substring(clickedIndex).trim()}if(!textToRead||textToRead.length<3){textToRead=textElement.textContent?.trim()||""}if(textToRead.length>0){window.speechSynthesis.cancel();const utterance=new SpeechSynthesisUtterance(textToRead);utterance.lang="pt-BR";utterance.rate=state.ttsRate||1;window.speechSynthesis.speak(utterance)}}};document.addEventListener("click",ttsClickHandler,true)}saveState()}function toggleStopSounds(active){state.stopSounds=active;document.querySelectorAll("audio, video").forEach(media=>{media.muted=active;if(active)media.pause()});document.querySelectorAll("iframe").forEach(iframe=>{try{const src=iframe.src;if(active){if(src.includes("youtube")){if(!src.includes("mute=1")){iframe.src=src+(src.includes("?")?"&":"?")+"mute=1"}}iframe.setAttribute("data-original-src",src)}}catch(e){}})}function toggleLibrasWidget(){document.querySelector("[vw-access-button]")?.click()}let currentGlossaryLetter='A';let alphabetExpanded=true;async function loadGlossary(){try{const response=await fetch('https://auditeduca.github.io/Calculadoras-de-Enfermagem/assets/data/glossario.json');glossaryData=(await response.json()).termos||[]}catch(e){console.warn('Glossario nao encontrado');glossaryData=[]}}function openGlossary(searchTerm=null){let modal=document.getElementById('glossary-modal');if(!modal){modal=document.createElement('div');modal.id='glossary-modal';modal.className='shortcuts-modal';modal.setAttribute('role','dialog');modal.setAttribute('aria-modal','true');const alphabet='ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');modal.innerHTML=`<div class="glossary-content"><header class="shortcuts-header"><h2><i class="fas fa-book-medical"></i> Glossario de Enfermagem</h2><button type="button" class="icon-btn" data-action="closeGlossary" aria-label="Fechar"><i class="fas fa-times"></i></button></header><div class="glossary-body"><nav class="glossary-alphabet" id="glossary-alphabet"><button type="button" class="alphabet-toggle" id="alphabet-toggle" title="Expandir/Retrair"><i class="fas fa-chevron-left"></i></button><div class="alphabet-letters" id="alphabet-letters">${alphabet.map(l=>`<button type="button" class="alphabet-letter${l==='A'?' active':''}" data-letter="${l}">${l}</button>`).join('')}</div></nav><div class="glossary-main"><div class="glossary-search"><input type="text" id="glossary-search-input" placeholder="Buscar termo..." autocomplete="off"></div><ul class="glossary-list" id="glossary-list"></ul></div></div></div>`;document.body.appendChild(modal);modal.querySelector('#alphabet-toggle').addEventListener('click',()=>{alphabetExpanded=!alphabetExpanded;modal.querySelector('.glossary-alphabet').classList.toggle('collapsed',!alphabetExpanded);modal.querySelector('#alphabet-toggle i').className=alphabetExpanded?'fas fa-chevron-left':'fas fa-chevron-right'});modal.querySelectorAll('.alphabet-letter').forEach(btn=>{btn.addEventListener('click',()=>{modal.querySelectorAll('.alphabet-letter').forEach(b=>b.classList.remove('active'));btn.classList.add('active');currentGlossaryLetter=btn.dataset.letter;modal.querySelector('#glossary-search-input').value='';renderGlossaryList()})});modal.querySelector('#glossary-search-input').addEventListener('input',(e)=>{const val=e.target.value;if(val){modal.querySelectorAll('.alphabet-letter').forEach(b=>b.classList.remove('active'));renderGlossaryList(val)}else{modal.querySelector(`.alphabet-letter[data-letter="${currentGlossaryLetter}"]`)?.classList.add('active');renderGlossaryList()}});modal.addEventListener('click',(e)=>{if(e.target===modal)closeGlossary()})}modal.hidden=false;if(searchTerm){const input=modal.querySelector('#glossary-search-input');input.value=searchTerm;modal.querySelectorAll('.alphabet-letter').forEach(b=>b.classList.remove('active'));renderGlossaryList(searchTerm)}else{renderGlossaryList()}setTimeout(()=>modal.querySelector('#glossary-search-input')?.focus(),100)}function renderGlossaryList(filter=''){const list=document.getElementById('glossary-list');if(!list)return;let filtered;if(filter){filtered=glossaryData.filter(item=>item.termo.toLowerCase().includes(filter.toLowerCase())||item.definicao.toLowerCase().includes(filter.toLowerCase()))}else{filtered=glossaryData.filter(item=>item.termo.charAt(0).toUpperCase()===currentGlossaryLetter)}if(filtered.length===0){list.innerHTML=`<li class="glossary-empty"><i class="fas fa-info-circle"></i> Nenhum termo com "${filter||currentGlossaryLetter}"</li>`;return}list.innerHTML=filtered.map(item=>`<li class="glossary-item"><div class="glossary-term">${sanitizeHTML(item.termo)}</div><div class="glossary-definition">${sanitizeHTML(item.definicao)}</div></li>`).join('')}function closeGlossary(){const modal=document.getElementById('glossary-modal');if(modal)modal.hidden=true}function setupTermLinks(){document.addEventListener('click',(e)=>{const term=e.target.closest('[data-definition], abbr[title]');if(term&&!term.closest('#accessibility-panel, #glossary-modal')){e.preventDefault();const searchTerm=term.textContent?.trim()||term.getAttribute('title')||'';if(searchTerm)openGlossary(searchTerm)}})}function resetAll(){ensureElements();Object.keys(state).forEach(key=>{if(!key.startsWith("_"))state[key]=typeof state[key]==="boolean"?false:0});state.ttsRate=1;document.documentElement.style.setProperty("--font-scale","1");document.documentElement.style.setProperty("--letter-spacing","0");document.documentElement.style.setProperty("--line-height","1.6");document.documentElement.style.setProperty("--cursor-scale","1");document.body.removeAttribute("data-font-scale");document.getElementById("accessibility-panel")?.classList.remove("font-large");allClasses.forEach(cls=>elements.body?.classList.remove(cls));elements.body.style.cursor="";if(mouseMoveHandler){window.removeEventListener("mousemove",mouseMoveHandler);mouseMoveHandler=null}if(readingGuideHandler){window.removeEventListener("mousemove",readingGuideHandler);readingGuideHandler=null}if(magnifierHandler){document.removeEventListener("mouseover",magnifierHandler);magnifierHandler=null}if(ttsClickHandler){document.removeEventListener("click",ttsClickHandler);ttsClickHandler=null}toggleReadingMask(false);toggleReadingGuide(false);toggleMagnifier(false);toggleStopSounds(false);window.speechSynthesis.cancel();ThemeManager.resetToSystem();document.querySelectorAll(".accessibility-card").forEach(card=>{card.classList.remove("active");updateAriaPressed(card,false);resetDots(card);const badge=card.querySelector(".level-badge");if(badge)badge.style.display="none"});["reading-mask-top","reading-mask-bottom","reading-guide","magnifier-tooltip"].forEach(id=>{const el=document.getElementById(id);if(el)el.style.display="none"});localStorage.removeItem("accessControlState");window.dispatchEvent(new CustomEvent("Accessibility:Reset"));announceToSR('Todas as configuracoes de acessibilidade foram restauradas');const btn=document.querySelector('[data-action="resetAll"]');if(btn){const original=btn.innerHTML;btn.innerHTML='<i class="fas fa-check" style="color:#10b981"></i> Restaurado!';setTimeout(()=>btn.innerHTML=original,1500)}}function handleCardClick(card){const type=card.dataset.type;const feature=card.dataset.feature;if(feature==="glossary"){openGlossary();return}if(type==="simple")toggleSimple(feature,card);else if(type==="cycle")cycleFeature(feature,card.dataset.values.split(","),card);else if(type==="tts-click")toggleTTSClick(card)}function handleAction(action){const actions={togglePanel,toggleMaximize,toggleLibras:toggleLibrasWidget,resetAll,showKeyboardShortcuts,closeShortcutsModal,openGlossary,closeGlossary};actions[action]?.()}function setupEvents(){document.addEventListener("click",(e)=>{const action=e.target.closest("[data-action]");if(action)return handleAction(action.dataset.action);const card=e.target.closest(".accessibility-card");if(card)return handleCardClick(card);if(!isPanelClosed()){const inPanel=elements.panel?.contains(e.target);const inWidgets=elements.sideWidgets?.contains(e.target);const inModal=elements.shortcutsModal?.contains(e.target);if(!inPanel&&!inWidgets&&!inModal)closePanel()}});document.addEventListener("keydown",(e)=>{if(e.key==="Escape"){closeShortcutsModal();closePanel();return}if((e.key==="Enter"||e.key===" ")&&e.target.closest(".accessibility-card")){e.preventDefault();handleCardClick(e.target.closest(".accessibility-card"));return}if(e.altKey){const shortcuts={"a":togglePanel,"1":()=>document.querySelector('[data-feature="fontSize"]')?.click(),"c":()=>document.querySelector('[data-feature="contrast"]')?.click(),"l":()=>document.querySelector('[data-feature="highlight-links"]')?.click(),"h":()=>document.querySelector('[data-feature="highlight-headers"]')?.click(),"m":()=>document.querySelector('[data-feature="readingMask"]')?.click(),"g":()=>document.querySelector('[data-feature="reading-guide"]')?.click(),"r":()=>document.querySelector('[data-feature="reading-mode"]')?.click(),"t":()=>document.querySelector('[data-feature="tts"]')?.click(),"i":()=>document.querySelector('[data-feature="hide-images"]')?.click(),"0":resetAll};if(shortcuts[e.key]){e.preventDefault();shortcuts[e.key]()}}})}function setupDrag(){const panel=document.getElementById("accessibility-panel");const handle=document.getElementById("panel-drag-handle");if(!panel||!handle)return;let isDragging=false;let offsetX=0,offsetY=0;handle.addEventListener("mousedown",(e)=>{if(e.target.closest("button"))return;isDragging=true;offsetX=e.clientX-panel.offsetLeft;offsetY=e.clientY-panel.offsetTop;handle.style.cursor="grabbing";e.preventDefault()});document.addEventListener("mousemove",(e)=>{if(!isDragging)return;const x=Math.max(0,Math.min(window.innerWidth-panel.offsetWidth,e.clientX-offsetX));const y=Math.max(0,Math.min(window.innerHeight-panel.offsetHeight,e.clientY-offsetY));panel.style.left=x+"px";panel.style.top=y+"px";panel.style.right="auto"});document.addEventListener("mouseup",()=>{isDragging=false;handle.style.cursor="grab"})}function init(){if(state._initialized)return;ThemeManager.init();if(ensureElements()){setupEvents();setupDrag();loadSavedState();loadGlossary();setupTermLinks()}state._initialized=true}return{init,togglePanel,toggleMaximize,resetAll,ThemeManager,state}})();function tryInit(){const panel=document.getElementById("accessibility-panel");if(panel){window.AccessControl.init()}else{setTimeout(tryInit,100)}}if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",tryInit)}else{tryInit()}